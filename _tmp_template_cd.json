{
  "name": "Template C+D",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "callback_query",
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -4640,
        288
      ],
      "id": "543a3a99-1e7b-4623-932b-7f66dcdab731",
      "name": "Telegram Trigger",
      "webhookId": "dafe6436-0e3d-489d-9830-1de2e0cd42f0",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const u = $json;\n\n// Try to find callback_query in several possible shapes\nconst cq =\n  u.callback_query ??\n  u.body?.callback_query ??\n  u.update?.callback_query ??\n  u.data?.callback_query ??\n  u;\n\n// Telegram callback basics\nconst queryId = cq?.id ?? null;\nconst data = cq?.data ?? cq?.callback_data ?? \"\";\nconst fromId = cq?.from?.id ?? cq?.user?.id ?? null;\n\n// Message where buttons are attached\nconst msg = cq?.message ?? {};\nconst chatId = msg?.chat?.id ?? null;\nconst messageId = msg?.message_id ?? null;\nconst messageText = msg?.text ?? msg?.caption ?? \"\";\n\n// Parse callback_data format: \"approve|<news_id>\" or \"reject|<news_id>\"\nlet action = \"\";\nlet newsId = \"\";\nif (typeof data === \"string\") {\n  const parts = data.split(\"|\");\n  action = (parts[0] || \"\").trim();\n  newsId = (parts[1] || \"\").trim();\n}\n\n// Map to final decision (support A1/R1/A2/R2 and approve/reject)\nlet decision = null;\n\nconst a = String(action || \"\").trim().toLowerCase();\n\nif (a === \"approve\" || a === \"a1\" || a === \"a2\") decision = \"approved\";\nif (a === \"reject\"  || a === \"x1\" || a === \"x2\") decision = \"rejected\";\n\nreturn [\n  {\n    action,\n    decision,\n    news_id: newsId,\n    tg_query_id: queryId,\n    tg_from_id: fromId,\n    tg_chat_id: chatId,\n    tg_message_id: messageId,\n    tg_message_text: messageText,\n    raw_callback_data: data,\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3504,
        272
      ],
      "id": "6bf389d8-2dfc-4ea2-b486-f5c378599461",
      "name": "–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ"
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $json.tg_query_id }}",
        "additionalFields": {
          "text": "={{ $json.decision === 'approved' ? '–ü—Ä–∏–Ω—è—Ç–æ ‚úÖ' : ($json.decision === 'rejected' ? '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ ‚ùå' : '–ù–µ –ø–æ–Ω—è–ª –∫–Ω–æ–ø–∫—É ü§∑') }}"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -3280,
        272
      ],
      "id": "7c44c677-f263-4931-b867-8d5036fd9f3a",
      "name": "Answer Query a callback",
      "webhookId": "73f08578-cabb-48db-8f76-e55c81f8e556",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE public.news_items\nSET\n  approve1_decision = 'approved', -- –ü–ò–®–ï–ú –ñ–ï–°–¢–ö–û, —Ç–∞–∫ –Ω–∞–¥–µ–∂–Ω–µ–µ\n  approve1_decided_at = now(),\n  approve1_decided_by = $2        -- ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±—ã–≤—à–∏–π $3)\nWHERE id = $1\nRETURNING id, approve1_decision;",
        "options": {
          "queryReplacement": "={{ [ $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').first().json.news_id, $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').first().json.tg_from_id ] }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2320,
        240
      ],
      "id": "db9ae6ab-01ed-43a9-80d5-e17e4302c215",
      "name": "–ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ –≤ –ë–î",
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "text"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1456,
        240
      ],
      "id": "f65fc188-42d5-48aa-a6dd-48414951fbc0",
      "name": "–°–∫–∞—á–∞—Ç—å HTML",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "html": "={{ $json.data }}"
      },
      "type": "n8n-nodes-webpage-content-extractor.webpageContentExtractor",
      "typeVersion": 1,
      "position": [
        -1008,
        224
      ],
      "id": "79f45de7-3ffc-470a-ba0a-f4026ece9e52",
      "name": "–≠–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä: –¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e91e8fc0-d348-476a-ada2-348300f5b206",
              "name": "news_id",
              "value": "={{$json.id}}",
              "type": "string"
            },
            {
              "id": "24861445-e300-43ef-aab2-5e4a9608736c",
              "name": "url",
              "value": "={{$json.canonical_url}}",
              "type": "string"
            },
            {
              "id": "61efaf5c-9149-4057-9baa-8dbde6e51f99",
              "name": "title",
              "value": "={{$json.title}}",
              "type": "string"
            },
            {
              "id": "9756b59b-fe6b-4a9f-94a7-845885a39eaf",
              "name": "image_url",
              "value": "={{$json.image_url}}",
              "type": "string"
            },
            {
              "id": "59db2840-503f-4c95-9f7e-f581e7e1426c",
              "name": "tittle",
              "value": "={{ $json.title }}",
              "type": "string"
            },
            {
              "id": "6e21c178-7afc-4772-a134-aef93dc7345f",
              "name": "rss_summary",
              "value": "={{ $json.rss_summary }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1648,
        240
      ],
      "id": "d1033e2f-6dfa-45b9-802e-83e5aa368ba0",
      "name": "–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT\n  MAX(chat_id) FILTER (WHERE purpose = 'rss_draft') AS rss_draft_chat_id,\n  MAX(chat_id) FILTER (WHERE purpose = 'approve')   AS approve_chat_id,\n  MAX(chat_id) FILTER (WHERE purpose = 'publish')   AS publish_chat_id\nFROM public.telegram_chats\nWHERE project_key = 'ainews'\n  AND is_active = true;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2544,
        240
      ],
      "id": "5d0bdc53-0ae1-48e1-a777-26275fca53b2",
      "name": "–ë–î: –ß–∞—Ç—ã Telegram",
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = $json.textContent ?? $json.cleanedText ?? '';\nconst cleanedText = String(input)\n  .replace(/[\\t]+/g, ' ')\n  .replace(/\\s\\s+/g, ' ')\n  .trim();\n\nreturn [{\n  json: {\n    ...$json,\n    cleanedText,\n    textLength: cleanedText.length,\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -544,
        224
      ],
      "id": "57c3b988-42e8-4600-94e8-d1cfc487b2ba",
      "name": "–ö–æ–¥: –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞"
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $('–ë–î: –ß–∞—Ç—ã Telegram').first().json.approve_chat_id }}",
        "binaryData": true,
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2528,
        -288
      ],
      "id": "87a2d8ac-3f04-4341-9a92-b898b1d03497",
      "name": "TG: –ê–ø—Ä—É–≤-2 (—Ñ–æ—Ç–æ)",
      "webhookId": "0a567f92-1cda-4ab8-affd-8cf9ba927238",
      "retryOnFail": true,
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('–ë–î: –ß–∞—Ç—ã Telegram').first().json.approve_chat_id }}",
        "text": "={{ $('Merge1').item.json.announce }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3120,
        304
      ],
      "id": "e74bd718-5ee8-4b32-b1c0-d7b19706ff87",
      "name": "TG: –ê–ø—Ä—É–≤-2 (–∞–Ω–æ–Ω—Å)",
      "webhookId": "aab7cb83-c65c-4149-9c5c-f8bc942d23bb",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "WITH upd AS (\n  UPDATE public.news_items\n  SET\n    drafts_updated_at = NOW(),\n    draft_announce = $1,\n    draft_longread = $2,\n    draft_image_prompt = $3,\n    status = 'drafts_ready'\n  WHERE id = $4\n  RETURNING id\n)\nSELECT\n  $4::text AS news_id,\n  $5::text AS title,\n  $6::text AS canonical_url,\n  $7::text AS image_url,\n  $8::text AS approve2_chat_id,\n  $1::text AS announce,\n  $2::text AS longread,\n  COALESCE($3::text, '') AS image_prompt\nFROM upd;\n",
        "options": {
          "queryReplacement": "={{[\n  $json.announce,\n  $json.longread_text,\n  $json.image_prompt,\n  $json.news_id,\n  $json.title,\n  $json.url,\n  $json.image_url,\n  $json.approve_chat_id\n]}}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        2320,
        288
      ],
      "id": "6516e1e8-7de2-40eb-890e-e9ae16d61b2e",
      "name": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏2",
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "b7af9a77-5593-4028-9d5b-6d4e5ed7a5c4",
              "leftValue": "={{ $json.image_url }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        2512,
        288
      ],
      "id": "50169a60-1d95-400a-83b7-fcd324561193",
      "name": "–ï—Å–ª–∏: –ï—Å—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∞?2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=TEXT:\n{{ $json.cleanedText }}",
        "options": {
          "systemMessage": "=- –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û —Ç–µ–∫—Å—Ç –ª–æ–Ω–≥—Ä–∏–¥–∞. –ë–µ–∑ JSON. –ë–µ–∑ markdown. –ë–µ–∑ –ª–∏—à–Ω–∏—Ö —Å—Ç—Ä–æ–∫/–ø–æ—è—Å–Ω–µ–Ω–∏–π.\n- –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Ñ–∞–∫—Ç—ã –∏–∑ –≤—Ö–æ–¥–Ω–æ–≥–æ TEXT. –ù–∏–∫–∞–∫–∏—Ö –¥–æ–≥–∞–¥–æ–∫ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–µ—Ç–∞–ª–µ–π.\n- –ü–∏—à–∏ –ø–æ-—Ä—É—Å—Å–∫–∏.\n\n–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:\n{{ $json.prompts.rewrite_longread }}\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        448,
        432
      ],
      "id": "85b13af9-fa0e-4594-9603-9c32f3910c0d",
      "name": "–ò–ò: –õ–æ–Ω–≥—Ä–∏–¥",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=TEXT:\n{{ $json.cleanedText }}",
        "options": {
          "systemMessage": "=–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û —Ç–µ–∫—Å—Ç –∞–Ω–æ–Ω—Å–∞. –ë–µ–∑ JSON, –±–µ–∑ markdown, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å—Ç—Ä–æ–∫/–ø–æ—è—Å–Ω–µ–Ω–∏–π.\n–ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Ñ–∞–∫—Ç—ã –∏–∑ TEXT. –ù–µ –¥–æ–±–∞–≤–ª—è–π –Ω–∏—á–µ–≥–æ –æ—Ç —Å–µ–±—è.\n{{ $('–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–º—Ç—ã').item.json.prompts.rewrite_announce }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        480,
        -32
      ],
      "id": "5cef3572-8006-4ea6-bfb8-028a2eae7721",
      "name": "–ò–ò: –ê–Ω–æ–Ω—Å",
      "retryOnFail": false,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=TITLE: {{ $json.title }}\nTEXT:\n{{ $json.cleanedText }}",
        "options": {
          "systemMessage": "=–ù–∞ –æ—Å–Ω–æ–≤–µ TITLE –∏ TEXT —Å–æ—Å—Ç–∞–≤—å –æ–¥–∏–Ω –ø—Ä–æ–º–ø—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–π –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ –∫ –º–∞—Ç–µ—Ä–∏–∞–ª—É.\n–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞. –û–î–ò–ù –∞–±–∑–∞—Ü. –ë–µ–∑ JSON. –ë–µ–∑ markdown. –ë–µ–∑ –ª–∏—à–Ω–∏—Ö —Å—Ç—Ä–æ–∫.\n–ù–µ –¥–æ–±–∞–≤–ª—è–π —Ñ–∞–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ TEXT.\n\n{{ $json.prompts.image_prompt }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        592,
        1008
      ],
      "id": "134a5de9-7e12-4063-9449-baa6c224ff7d",
      "name": "–ü—Ä–æ–º—Ç 3. –ò–ò: –ö–∞—Ä—Ç–∏–Ω–∫–∞",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "9faad409-38a1-4d03-b46e-fe1ef3e10351",
              "leftValue": "={{ $('–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏').item.json.image_url }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        368,
        912
      ],
      "id": "41bd46e1-2bb3-4abe-b72d-49dcc394c90f",
      "name": "–ï—Å—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∞?"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "numberInputs": 4,
        "options": {
          "includeUnpaired": false
        }
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1152,
        272
      ],
      "id": "d07d0a25-0c3f-42ce-89fc-bcdac3ca5994",
      "name": "Merge"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "249ab08e-dcfc-466a-833d-27916ed48457",
              "leftValue": "={{ $json.data }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -1248,
        240
      ],
      "id": "992ee9a8-eeaf-4126-b71b-855802a2307c",
      "name": "–ü–æ–ª—É—á–∏–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É?"
    },
    {
      "parameters": {
        "chatId": "={{ $('–ë–î: –ß–∞—Ç—ã Telegram').item.json.approve_chat_id }}",
        "text": "=–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -928,
        560
      ],
      "id": "2d5584a1-6958-41fe-9fc5-dee7e140af2b",
      "name": "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É",
      "webhookId": "aab7cb83-c65c-4149-9c5c-f8bc942d23bb",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "249ab08e-dcfc-466a-833d-27916ed48457",
              "leftValue": "={{ $json.textContent }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -800,
        224
      ],
      "id": "7a6ab466-5a0c-4c05-a496-bb85d3eda99a",
      "name": "–ü–æ–ª—É—á–∏–ª–æ—Å—å –ø—Ä–∏–≤–µ—Å—Ç–∏ –≤ –ø–æ—Ä—è–¥–æ–∫?"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9756b59b-fe6b-4a9f-94a7-845885a39eaf",
              "name": "image_url",
              "value": "={{ $('–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏').item.json.image_url }}",
              "type": "string"
            },
            {
              "id": "821f09b9-2d7c-43e8-a4db-446145eafd07",
              "name": "image_prompt",
              "value": "null",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        624,
        768
      ],
      "id": "65f9fa75-1dd9-4223-b839-f55b138050a2",
      "name": "–ö–∞—Ä—Ç–∏–Ω–∫–∞",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9756b59b-fe6b-4a9f-94a7-845885a39eaf",
              "name": "longread_text",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        800,
        432
      ],
      "id": "702366b4-11d2-4a9d-ad0f-45a5f96828dd",
      "name": "–õ–æ–Ω–≥—Ä–∏–¥"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9756b59b-fe6b-4a9f-94a7-845885a39eaf",
              "name": "announce",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        800,
        -32
      ],
      "id": "33155928-baaf-44dc-9f7c-4e368f66db98",
      "name": "–ê–Ω–æ–Ω—Å"
    },
    {
      "parameters": {
        "jsCode": "function s(v) {\n  if (v === null || v === undefined) return \"\";\n  return String(v).trim();\n}\n\nconst announce = s($json.announce);\nconst longreadText = s($json.longread_text);\nconst imageUrl = s($json.image_url);\nconst imagePrompt = s($json.image_prompt) || null;\n\nreturn [{\n  json: {\n    ...$json,\n    announce,\n    longread_text: longreadText,\n    image_prompt: imagePrompt,\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1360,
        304
      ],
      "id": "c950cf3e-b871-4547-b6f6-5fb31cc322b4",
      "name": "–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        2080,
        288
      ],
      "id": "e6c182bc-008a-465c-bbd1-f7beca8abce9",
      "name": "Merge1"
    },
    {
      "parameters": {
        "chatId": "={{ $('–ë–î: –ß–∞—Ç—ã Telegram').first().json.approve_chat_id }}",
        "text": "–ü—É–±–ª–∏–∫—É–µ–º?",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è",
                    "additionalFields": {
                      "callback_data": "={{ 'A2|' + $('–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏2').first().json.news_id }}"
                    }
                  },
                  {
                    "text": "‚úçÔ∏è –ü—Ä–∞–≤–∫–∏",
                    "additionalFields": {
                      "callback_data": "={{ 'R2|' + $('–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏2').first().json.news_id }}"
                    }
                  },
                  {
                    "text": "üóëÔ∏è –í –∫–æ—Ä–∑–∏–Ω—É",
                    "additionalFields": {
                      "callback_data": "={{ 'X2|' + $('–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏2').first().json.news_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4336,
        16
      ],
      "id": "4579c68a-1c48-4551-adf9-d07a2de31f3e",
      "name": "TG: –ê–ø—Ä—É–≤-2 (–∫–Ω–æ–ø–∫–∏)1",
      "webhookId": "d8c99276-b352-4077-831b-02939ef152e6",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const MAX_LEN = 3800;\n\nfunction splitByParagraphs(text, maxLen) {\n  const parts = [];\n  const paras = String(text || \"\").split(/\\n\\s*\\n/);\n  let buf = \"\";\n\n  function pushBuf() {\n    const t = buf.trim();\n    if (t) parts.push(t);\n    buf = \"\";\n  }\n\n  for (const pRaw of paras) {\n    const p = pRaw.trim();\n    if (!p) continue;\n\n    if ((buf.length ? buf.length + 2 : 0) + p.length <= maxLen) {\n      buf = buf ? (buf + \"\\n\\n\" + p) : p;\n      continue;\n    }\n\n    pushBuf();\n\n    if (p.length <= maxLen) {\n      buf = p;\n      continue;\n    }\n\n    let s = p;\n    while (s.length > maxLen) {\n      parts.push(s.slice(0, maxLen));\n      s = s.slice(maxLen);\n    }\n    buf = s;\n  }\n\n  pushBuf();\n  return parts;\n}\n\n// --- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–î–ï–°–¨ ---\n// –ú—ã –±–µ—Ä–µ–º —Ç–µ–∫—Å—Ç –Ω–µ –∏–∑ $json (–≤—Ö–æ–¥—è—â–µ–≥–æ), –∞ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –Ω–æ–¥—ã –ë–î\n// –ò—Å–ø–æ–ª—å–∑—É–µ–º .first(), —Ç–∞–∫ –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ–¥–Ω—É –Ω–æ–≤–æ—Å—Ç—å –∑–∞ —Ä–∞–∑\nconst item = $('–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏2').first(); \nconst longread = item ? (item.json.longread || \"\") : \"\";\n// -------------------------\n\nconst chunks = splitByParagraphs(longread, MAX_LEN);\n\n// –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –ø—É—Å—Ç–æ–π, –≤–µ—Ä–Ω–µ–º —Ö–æ—Ç—è –±—ã –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç, —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å –ø–æ—Ç–æ–∫\nif (chunks.length === 0) {\n    return [{ json: { text: \"–û—à–∏–±–∫–∞: –¢–µ–∫—Å—Ç –ª–æ–Ω–≥—Ä–∏–¥–∞ –ø—É—Å—Ç\" } }];\n}\n\nreturn chunks.map((t, i) => ({\n  json: {\n    text: (chunks.length > 1 ? `[${i + 1}/${chunks.length}]\\n\\n` : \"\") + t\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3344,
        304
      ],
      "id": "eae39550-ba1b-4256-a2e1-1f8590f76542",
      "name": "–ö–æ–¥: –†–∞–∑–±–∏—Ç—å –ª–æ–Ω–≥—Ä–∏–¥ –¥–ª—è –¢–ì"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        3632,
        304
      ],
      "id": "0246252d-485a-4542-a64c-dd8aafce917e",
      "name": "–¶–∏–∫–ª: –ß–∞—Å—Ç–∏ –ª–æ–Ω–≥—Ä–∏–¥–∞"
    },
    {
      "parameters": {
        "chatId": "={{ $('–ë–î: –ß–∞—Ç—ã Telegram').first().json.approve_chat_id }}",
        "text": "={{ $json.text }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        4000,
        320
      ],
      "id": "e44b98dc-8c57-4f4a-a4ca-14b304e26a7b",
      "name": "TG: –ê–ø—Ä—É–≤-2 (–ª–æ–Ω–≥—Ä–∏–¥ —á–∞—Å—Ç—å)",
      "webhookId": "88689bdd-ddd8-4d67-a057-afcc0fcaac00",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "92cd1a84-b7b1-42f7-a777-400e0346c391",
              "leftValue": "={{ $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.action }}",
              "rightValue": "=A1",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -2784,
        256
      ],
      "id": "26e936dd-4142-4ff4-a396-5e1eed0dfe32",
      "name": "–ê–ø–ø—Ä—É–≤–∏–º RSS?"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.news_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status",
              "fieldValue": "rejected"
            },
            {
              "fieldId": "approve1_decided_at",
              "fieldValue": "={{ $now }}"
            },
            {
              "fieldId": "approve1_decided_by",
              "fieldValue": "={{ $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.tg_from_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2544,
        512
      ],
      "id": "6f72e1c6-b433-46cb-9299-3bab22ac5268",
      "name": "–ë–î: –û—Ç–∫–ª–æ–Ω–∏—Ç—å (X1)",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "97efc181-86f1-4a23-a41a-05bf8074aabc",
              "leftValue": "={{ $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.decision }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "8c1f7c6f-cab4-4071-8ed5-e613a7db9400",
              "leftValue": "={{ $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.news_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -3056,
        272
      ],
      "id": "6fba279b-c043-4ff9-ab52-476603da751a",
      "name": "–ù—É–∂–Ω—ã–µ –∫–Ω–æ–ø–∫–∏?"
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.tg_chat_id }}",
        "messageId": "={{ $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.tg_message_id }}",
        "text": "={{ $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.tg_message_text + '\\n\\n‚ùå –ù–æ–≤–æ—Å—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞' }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2336,
        512
      ],
      "id": "2e8bffdb-c355-4525-8014-9a2741b9bee6",
      "name": "TG: –ù–æ–≤–æ—Å—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞",
      "webhookId": "6d4a307f-c446-411c-a383-c9afe3c5e1d6",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "resource": "image",
        "prompt": "={{ $json.output }}",
        "model": "dall-e-3",
        "responseFormat": "imageUrl",
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [
        4256,
        2544
      ],
      "id": "e7edce6c-445a-45e1-846d-20f0e4aaf017",
      "name": "OpenAI: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏",
      "credentials": {
        "openAiApi": {
          "id": "U1pcqbZS37eHdBPO",
          "name": "OpenAi account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "prompt-field",
              "name": "image_prompt",
              "value": "={{ $('–ü—Ä–æ–º—Ç 3. –ò–ò: –ö–∞—Ä—Ç–∏–Ω–∫–∞').item.json.output }}",
              "type": "string"
            },
            {
              "id": "url-field",
              "name": "image_url",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1008,
        672
      ],
      "id": "624ccbd4-fe13-44c4-aa8f-ea7c6125799c",
      "name": "image_url"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE public.news_items\nSET approve2_text_message_id = $2\nWHERE id = $1\nRETURNING id, approve2_text_message_id;",
        "options": {
          "queryReplacement": "={{ [ $('–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏2').first().json.news_id, $json.result.message_id ] }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        3344,
        -144
      ],
      "id": "c0b1a5ae-0251-4609-a589-905eedcde6a3",
      "name": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ID –∞–Ω–æ–Ω—Å–∞",
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE public.news_items\nSET \n  approve2_photo_message_id = $2,\n  draft_image_file_id = $3\nWHERE id = $1;",
        "options": {
          "queryReplacement": "={{ [ \n  $('–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏2').first().json.news_id, \n  $json.result.message_id, \n  $json.result.photo.slice(-1)[0].file_id \n] }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        2704,
        -288
      ],
      "id": "9e5e5695-3a50-4133-9539-d04179dc2a52",
      "name": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ID —Ñ–æ—Ç–æ",
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "keyValue": "={{ $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.news_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1872,
        240
      ],
      "id": "e4f687de-5714-4f6c-9f51-616666355771",
      "name": "–ü–æ–ª—É—á–∏—Ç—å id",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('–ë–î: –ß–∞—Ç—ã Telegram').item.json.rss_draft_chat_id }}",
        "messageId": "={{ $('Telegram Trigger').item.json.callback_query.message.message_id }}",
        "text": "={{ $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.tg_message_text + '\\n\\n' + ($('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.decision === 'approved' ? '‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ' : '‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ') }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2096,
        240
      ],
      "id": "56fea701-a643-4956-a9e8-764fd0050c80",
      "name": "–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É",
      "webhookId": "2364dc7d-af90-4c16-ab77-2add3cd9701c",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT jsonb_object_agg(key, content) AS prompts\nFROM public.system_prompts\nWHERE key IN ('rewrite_title','rewrite_announce','rewrite_longread','image_prompt');\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -144,
        -288
      ],
      "id": "87cc5b41-fc7a-4e96-aba6-28cc634c8f22",
      "name": "–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–º—Ç—ã",
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        176,
        224
      ],
      "id": "438adb48-952c-4e10-adc7-c53918b9eb77",
      "name": "–°—Ç–∞—Ç—å—è+–ø—Ä–æ–º—Ç—ã"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT\n  MAX(chat_id) FILTER (WHERE purpose = 'rss_draft') AS rss_draft_chat_id,\n  MAX(chat_id) FILTER (WHERE purpose = 'approve')   AS approve_chat_id,\n  MAX(chat_id) FILTER (WHERE purpose = 'publish')   AS publish_chat_id\nFROM public.telegram_chats\nWHERE project_key = 'ainews'\n  AND is_active = true;\n",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 1,
      "position": [
        -3344,
        2288
      ],
      "id": "fd111016-ffba-4ad0-b7c1-115049c7ec14",
      "name": "–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤",
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Normalization for Telegram updates (callback_query + message)\n// Works even if trigger node name differs (Telegram Trigger / –¢—Ä–∏–≥–≥–µ—Ä Telegram)\n\nfunction pickTriggerItem() {\n  // Try by exact node names (most stable in complex flows)\n  try {\n    const a = $items(\"–¢—Ä–∏–≥–≥–µ—Ä Telegram\");\n    if (a && a[0]) return a[0];\n  } catch (e) {}\n\n  try {\n    const b = $items(\"Telegram Trigger\");\n    if (b && b[0]) return b[0];\n  } catch (e) {}\n\n  // Fallback: sometimes the trigger payload is already in $json\n  const inItem = $input.first();\n  if (inItem && inItem.json) return inItem;\n\n  throw new Error(\"Telegram trigger item not found. Rename trigger node or execute workflow from trigger.\");\n}\n\nfunction unwrapTelegramPayload(j) {\n  // Different n8n/telegram nodes may wrap payload differently\n  // Prefer explicit wrappers, else return as-is\n  if (j && typeof j === \"object\") {\n    if (j.body && typeof j.body === \"object\") return j.body;\n    if (j.update && typeof j.update === \"object\") return j.update;\n  }\n  return j;\n}\n\nconst tgItem = pickTriggerItem();\nconst raw = tgItem.json || {};\nconst body = unwrapTelegramPayload(raw);\n\n// 1) CALLBACK HANDLING\nif (body && body.callback_query) {\n  const cq = body.callback_query;\n  const data = String(cq.data || cq.callback_data || \"\");\n  const parts = data.split(\"|\");\n\n  const action = (parts[0] || \"\").trim();\n  const newsId = (parts[1] || \"\").trim();\n  const target = (parts[2] || \"\").trim();\n\n  const msg = cq.message || null;\n  const chatId = msg && msg.chat ? msg.chat.id : null;\n  const messageId = msg ? msg.message_id : null;\n  const messageText = msg ? String(msg.text || msg.caption || \"\") : \"\";\n\n  return [{\n    json: {\n      type: \"callback\",\n      action: action,\n      router_action: action,\n      router_data: data,\n\n      news_id: newsId,\n      target: target || null,\n\n      query_id: cq.id || null,\n      from_id: cq.from ? cq.from.id : null,\n      chat_id: chatId,\n      message_id: messageId,\n      message_text: messageText\n    }\n  }];\n}\n\n// 2) MESSAGE HANDLING (text/voice/reply)\nif (body && body.message) {\n  const m = body.message;\n\n  return [{\n    json: {\n      type: \"message\",\n      from_id: m.from ? m.from.id : null,\n      chat_id: m.chat ? m.chat.id : null,\n      message_id: m.message_id || null,\n      text: String(m.text || \"\"),\n\n      voice_file_id: m.voice ? m.voice.file_id : null,\n      reply_to_message_id: (m.reply_to_message && m.reply_to_message.message_id) ? m.reply_to_message.message_id : null\n    }\n  }];\n}\n\nreturn [{\n  json: {\n    type: \"unknown\",\n    debug_input: body\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        -3120,
        2288
      ],
      "id": "a01a0947-cd90-4c61-8586-34320898c886",
      "name": "–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.type }}",
              "value2": "callback"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -2896,
        2288
      ],
      "id": "b84e685e-35eb-43df-9f32-dbf31be53835",
      "name": "–ï—Å–ª–∏: –≠—Ç–æ –∫–Ω–æ–ø–∫–∞?"
    },
    {
      "parameters": {
        "resource": "callback",
        "queryId": "={{ $json.query_id }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2672,
        2048
      ],
      "id": "da65b7bc-b3d6-4c41-81a7-e1752c8b9706",
      "name": "TG: Answer Callback",
      "webhookId": "f116e3ac-79a4-4018-9c5f-e9ab6b5b3b4b",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.action }}",
                    "rightValue": "A2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "6861ac48-1d95-42ab-8187-5c97cfd2223a"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "A2 (–û–¥–æ–±—Ä–∏—Ç—å)"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.action }}",
                    "rightValue": "R2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "R2 (–ü—Ä–∞–≤–∫–∏)"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.action }}",
                    "rightValue": "X2",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "X2 (–°–∫–∏–ø)"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.action }}",
                    "rightValue": "Edit",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–í—ã–±–æ—Ä —Ç–∏–ø–∞ –ø—Ä–∞–≤–∫–∏"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.action }}",
                    "rightValue": "CancelEdit",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–û—Ç–º–µ–Ω–∞"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.action }}",
                    "rightValue": "PubNow",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–ü—É–±–ª–∏–∫–∞—Ü–∏—è: –°–µ–π—á–∞—Å"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.action }}",
                    "rightValue": "PubLater",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–ü—É–±–ª–∏–∫–∞—Ü–∏—è: –ü–æ—Ç–æ–º"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -2400,
        2064
      ],
      "id": "9be6293f-c0f3-4880-b2ef-0ad84db73987",
      "name": "Switch: –î–µ–π—Å—Ç–≤–∏–µ"
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "‚è∞ –ö–æ–≥–¥–∞ –ø—É–±–ª–∏–∫—É–µ–º –Ω–æ–≤–æ—Å—Ç—å?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üöÄ –ü—Ä—è–º–æ —Å–µ–π—á–∞—Å",
                    "additionalFields": {
                      "callback_data": "={{ 'PubNow|' + $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').first().json.news_id }}"
                    }
                  },
                  {
                    "text": "üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å",
                    "additionalFields": {
                      "callback_data": "={{ 'PubLater|' + $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').first().json.news_id }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üîô –ù–∞–∑–∞–¥",
                    "additionalFields": {
                      "callback_data": "={{ 'CancelEdit|' + $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.news_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2032,
        1584
      ],
      "id": "a60c61e9-3447-410b-a1ae-df9c522859d5",
      "name": "TG: –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏",
      "webhookId": "778376b4-6155-4ee8-a381-4fdd212cee5c",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "üëá –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –±—É–¥–µ–º –ø—Ä–∞–≤–∏—Ç—å?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üì¢ –ê–Ω–æ–Ω—Å",
                    "additionalFields": {
                      "callback_data": "={{ 'Edit|' + $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.news_id + '|announce' }}"
                    }
                  },
                  {
                    "text": "üìú –õ–æ–Ω–≥—Ä–∏–¥",
                    "additionalFields": {
                      "callback_data": "={{ 'Edit|' + $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.news_id + '|longread' }}"
                    }
                  },
                  {
                    "text": "üñº –ö–∞—Ä—Ç–∏–Ω–∫–∞",
                    "additionalFields": {
                      "callback_data": "={{ 'Edit|' + $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.news_id + '|image' }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üîô –û—Ç–º–µ–Ω–∞ (–ø–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é)",
                    "additionalFields": {
                      "callback_data": "={{ 'CancelEdit|' + $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.news_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1760,
        1776
      ],
      "id": "50669ccd-df19-46ec-b10e-fc04a4bfea98",
      "name": "TG: –ú–µ–Ω—é –ø—Ä–∞–≤–æ–∫",
      "webhookId": "071824ba-ea8a-4c41-afd6-ea388076da1f",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.message_id }}",
        "text": "üóë –ù–æ–≤–æ—Å—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω–µ",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2080,
        2032
      ],
      "id": "1aaa9654-a7ff-4a27-8bee-6d49729ed982",
      "name": "TG: –£–¥–∞–ª–∏—Ç—å –∫–Ω–æ–ø–∫–∏ (X2)",
      "webhookId": "fc8ea779-088d-436b-96f1-ebdbd9f11b43",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "text": "={{ '‚úèÔ∏è –í—ã–±—Ä–∞–Ω–æ: ' + ($('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.target === 'announce' ? '–ê–Ω–æ–Ω—Å' : ($('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.target === 'longread' ? '–õ–æ–Ω–≥—Ä–∏–¥' : ($('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.target === 'image' ? '–ö–∞—Ä—Ç–∏–Ω–∫–∞' : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ (' + $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.target + ')'))) + '\\n\\n–ù–∞–ø–∏—à–∏ (–∏–ª–∏ —Å–∫–∞–∂–∏), —á—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å?' }}",
        "replyMarkup": "forceReply",
        "forceReply": {},
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2096,
        2208
      ],
      "id": "c9ecda8a-f8db-4f46-bc9a-68633fab22da",
      "name": "TG: –ó–∞–ø—Ä–æ—Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
      "webhookId": "bf11dc16-5a69-4262-8ff6-f139a142c03e",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "=–ü—É–±–ª–∏–∫—É–µ–º?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è",
                    "additionalFields": {
                      "callback_data": "={{ 'A2|' + $json.id }}"
                    }
                  },
                  {
                    "text": "‚úçÔ∏è –ü—Ä–∞–≤–∫–∏",
                    "additionalFields": {
                      "callback_data": "={{ 'R2|' + $json.id }}"
                    }
                  },
                  {
                    "text": "üóëÔ∏è –°–∫–∏–ø",
                    "additionalFields": {
                      "callback_data": "={{ 'X2|' + $json.id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1872,
        2400
      ],
      "id": "9975e0d7-8aa3-4aaa-941f-240189dcff29",
      "name": "TG: –í–µ—Ä–Ω—É—Ç—å –º–µ–Ω—é",
      "webhookId": "ed7f3341-259d-4a17-9306-1982a0e65b6d",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "text": "üöÄ –ù–æ–≤–æ—Å—Ç—å –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ). –ñ–¥–∏—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -944,
        2624
      ],
      "id": "44d7967d-de7a-4a47-a563-f4ba4bc748ce",
      "name": "TG: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (Now)",
      "webhookId": "067f1c81-7814-4638-951a-6a625581c701",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "text": "üìÖ –ù–∞–ø–∏—à–∏ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.\n–ü—Ä–∏–º–µ—Ä: \"–∑–∞–≤—Ç—Ä–∞ –≤ 10:00\" –∏–ª–∏ \"—á–µ—Ä–µ–∑ 2 —á–∞—Å–∞\".",
        "replyMarkup": "forceReply",
        "forceReply": {},
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2080,
        2816
      ],
      "id": "9b60df4a-9570-4a3f-8601-6aea8ba57978",
      "name": "TG: –°–ø—Ä–æ—Å–∏—Ç—å –¥–∞—Ç—É",
      "webhookId": "2139404f-ef40-4c7d-b1b4-e3a719a3ec3c",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.voice_file_id }}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -2720,
        3360
      ],
      "id": "d2f0911d-5f5f-465a-8ec8-c095703e818a",
      "name": "–ï—Å–ª–∏: –≠—Ç–æ –≥–æ–ª–æ—Å?"
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.voice_file_id }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2496,
        3184
      ],
      "id": "ad24690d-3401-4470-bb6b-321b5d4a2cd1",
      "name": "TG: –°–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ",
      "webhookId": "65213544-abe0-497a-b38c-06d2820b0a59",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {
          "language": "ru"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1,
      "position": [
        -2240,
        3184
      ],
      "id": "2487cc47-b992-4b4e-b567-a77182d62b7b",
      "name": "OpenAI: –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è",
      "credentials": {
        "openAiApi": {
          "id": "U1pcqbZS37eHdBPO",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.rewrite2_state }}",
                    "rightValue": "awaiting_announce",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–ê–Ω–æ–Ω—Å"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.rewrite2_state }}",
                    "rightValue": "awaiting_longread",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–õ–æ–Ω–≥—Ä–∏–¥"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.rewrite2_state }}",
                    "rightValue": "awaiting_image",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–ö–∞—Ä—Ç–∏–Ω–∫–∞"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.rewrite2_state }}",
                    "rightValue": "awaiting_pub_date",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -1328,
        3344
      ],
      "id": "3b39e9f7-c73e-464e-a0c8-39eebf2295b1",
      "name": "–ß—Ç–æ –ø—Ä–∞–≤–∏–º?"
    },
    {
      "parameters": {
        "resource": "image",
        "prompt": "={{ $json.output }}",
        "options": {
          "size": "1024x1024",
          "style": "vivid",
          "returnImageUrls": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1,
      "position": [
        -1792,
        3728
      ],
      "id": "86705665-8eb1-4da6-a062-9b50c26a2dd9",
      "name": "OpenAI: DALL-E 3",
      "credentials": {
        "openAiApi": {
          "id": "U1pcqbZS37eHdBPO",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "text": "={{ 'üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞: ' +\n  new Date($items('–ö–æ–¥: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Jobs1')[$itemIndex].json.publish_at)\n    .toLocaleString('ru-RU', {\n      timeZone: 'Europe/Moscow',\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit'\n    })\n}}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        176,
        4208
      ],
      "id": "b3c717da-8ede-48e3-9a43-a95c29e91248",
      "name": "TG: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (–ü–ª–∞–Ω)",
      "webhookId": "39e626a0-5678-43c6-a37c-b05da7b73f9b",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "keyValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.news_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2096,
        2400
      ],
      "id": "67377620-b340-40ba-ac92-a0d9d8fd64f9",
      "name": "–ë–î: –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "news_items",
        "limit": 1,
        "filters": {
          "conditions": [
            {
              "keyName": "rewrite2_state",
              "condition": "like",
              "keyValue": "awaiting%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1616,
        3376
      ],
      "id": "89e59c38-0db7-4453-9725-a448f105a8fd",
      "name": "–ë–î: –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é –ø—Ä–∞–≤–∫—É",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.news_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "rewrite2_state",
              "fieldValue": "selecting"
            },
            {
              "fieldId": "rewrite2_requester_id",
              "fieldValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.from_id }}"
            },
            {
              "fieldId": "rewrite2_requested_at",
              "fieldValue": "={{ $now }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1984,
        1776
      ],
      "id": "867d7d73-a6b2-4506-b192-8bd260588c1a",
      "name": "–ë–î: –°—Ç–∞—Ä—Ç –ø—Ä–∞–≤–∫–∏ (R2)",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('–ë–î: –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é –ø—Ä–∞–≤–∫—É').item.json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "draft_longread",
              "fieldValue": "={{ $json.output }}"
            },
            {
              "fieldId": "rewrite2_state",
              "fieldValue": "={{ null }}"
            },
            {
              "fieldId": "drafts_updated_at",
              "fieldValue": "={{ $now }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -640,
        3296
      ],
      "id": "dd4f7995-7570-4553-9af6-183c2fec00e3",
      "name": "–ë–î: –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–Ω–≥—Ä–∏–¥",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.news_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "rewrite2_state",
              "fieldValue": "awaiting_pub_date"
            },
            {
              "fieldId": "rewrite2_request_message_id",
              "fieldValue": "={{ $json.result.message_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1888,
        2816
      ],
      "id": "e5bbec5a-fbe8-494d-b859-a6484b4af3b9",
      "name": "–ë–î: –ñ–¥–µ–º –¥–∞—Ç—É",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('–ë–î: –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é –ø—Ä–∞–≤–∫—É').item.json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "draft_image_prompt",
              "fieldValue": "={{ $('AI: –ü—Ä–æ–º—Ç –¥–ª—è DALL-E').item.json.output }}"
            },
            {
              "fieldId": "draft_image_file_id",
              "fieldValue": "={{ $json.result.photo[3].file_id }}"
            },
            {
              "fieldId": "drafts_updated_at",
              "fieldValue": "={{ $now }}"
            },
            {
              "fieldId": "rewrite2_state",
              "fieldValue": "={{ null }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        496,
        3760
      ],
      "id": "305e7dc2-1336-4c3c-8b85-71267bf2a460",
      "name": "–ë–î: –û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.message_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1216,
        2624
      ],
      "id": "e8a08305-4759-4287-b902-a537f6f08296",
      "name": "TG: –£–¥–∞–ª–∏—Ç—å –º–µ–Ω—é –≤—Ä–µ–º–µ–Ω–∏",
      "webhookId": "5661c516-167a-4dc9-9b6d-cbb31be16d42",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('–ë–î: –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é –ø—Ä–∞–≤–∫—É').item.json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "draft_announce",
              "fieldValue": "={{ $json.output }}"
            },
            {
              "fieldId": "rewrite2_state",
              "fieldValue": "={{ null }}"
            },
            {
              "fieldId": "drafts_updated_at",
              "fieldValue": "={{ $now }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -688,
        2944
      ],
      "id": "7f02145a-d777-4b6a-84f0-2852cdb0dfee",
      "name": "–ë–î: –û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–æ–Ω—Å",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "text-set",
              "name": "text",
              "value": "={{ $json.text }}",
              "type": "string"
            },
            {
              "id": "reply-set",
              "name": "reply_to_message_id",
              "value": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.reply_to_message_id }}",
              "type": "string"
            },
            {
              "id": "chat-set",
              "name": "chat_id",
              "value": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.chat_id }}",
              "type": "string"
            },
            {
              "id": "from-set",
              "name": "from_id",
              "value": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.from_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1920,
        3376
      ],
      "id": "01e15717-185d-4bda-a909-d3acbc6bcd91",
      "name": "–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "keyValue": "={{ $('–ë–î: –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é –ø—Ä–∞–≤–∫—É').item.json.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -416,
        2944
      ],
      "id": "43075432-40cb-441c-8513-f302ef4b2eb2",
      "name": "–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.message_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -192,
        2944
      ],
      "id": "2cd9bf59-8a06-42a3-b15c-1b9d1cc4782e",
      "name": "TG: –£–¥–∞–ª–∏—Ç—å –æ—Ç–≤–µ—Ç —é–∑–µ—Ä–∞",
      "webhookId": "20292647-c666-42b4-9861-a3d764e67bf7",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ').item.json.rewrite2_question_message_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        16,
        2944
      ],
      "id": "0e9157d2-e41b-4714-875e-3c7bfdc0ea6b",
      "name": "TG: –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å –±–æ—Ç–∞",
      "webhookId": "00cd84ae-bd3b-4485-8fbb-efdbb3c5c568",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.news_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "rewrite2_state",
              "fieldValue": "={{ 'awaiting_' + $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.target }}"
            },
            {
              "fieldId": "rewrite2_request_message_id",
              "fieldValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.message_id }}"
            },
            {
              "fieldId": "rewrite2_question_message_id",
              "fieldValue": "={{ $('TG: –ó–∞–ø—Ä–æ—Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏').item.json.result.message_id }}"
            },
            {
              "fieldId": "rewrite2_requester_id",
              "fieldValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.from_id }}"
            },
            {
              "fieldId": "rewrite2_chat_id",
              "fieldValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.chat_id }}"
            },
            {
              "fieldId": "rewrite2_requested_at",
              "fieldValue": "={{ $now }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1872,
        2208
      ],
      "id": "94909e07-f14c-4f49-b83e-ca25c45f726f",
      "name": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–ª—å –ø—Ä–∞–≤–∫–∏",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ').first().json.approve2_text_message_id }}",
        "text": "=‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: \n\n{{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ').item.json.draft_announce }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        256,
        2768
      ],
      "id": "8540105c-13fc-44ff-a0a1-659d7d270ca9",
      "name": "–û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–æ–Ω—Å",
      "webhookId": "7a099cfe-b97f-4d20-b997-245848763007",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "keyValue": "={{ $('–ë–î: –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é –ø—Ä–∞–≤–∫—É').item.json.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -432,
        3296
      ],
      "id": "900bf39b-efad-4fc6-948c-cb01964e7a5a",
      "name": "–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.message_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -208,
        3296
      ],
      "id": "907672d7-0e66-45b0-9c5b-3823c7622b57",
      "name": "TG: –£–¥–∞–ª–∏—Ç—å –æ—Ç–≤–µ—Ç —é–∑–µ—Ä–∞1",
      "webhookId": "20292647-c666-42b4-9861-a3d764e67bf7",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1').item.json.rewrite2_question_message_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        48,
        3296
      ],
      "id": "e06497b4-d90a-4be5-82a6-7200dd35d78b",
      "name": "TG: –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å –±–æ—Ç–∞1",
      "webhookId": "00cd84ae-bd3b-4485-8fbb-efdbb3c5c568",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ').item.json.approve2_message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "=‚úÖ –ê–Ω–æ–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω. –ü—É–±–ª–∏–∫—É–µ–º –Ω–æ–≤–æ—Å—Ç—å?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è",
                    "additionalFields": {
                      "callback_data": "={{ 'A2|' + $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ').item.json.id }}"
                    }
                  },
                  {
                    "text": "‚úçÔ∏è –ü—Ä–∞–≤–∫–∏",
                    "additionalFields": {
                      "callback_data": "={{ 'R2|' + $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ').item.json.id }}"
                    }
                  },
                  {
                    "text": "üóëÔ∏è –°–∫–∏–ø",
                    "additionalFields": {
                      "callback_data": "={{ 'X2|' + $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ').item.json.id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        256,
        3072
      ],
      "id": "d1b16a68-c393-43fe-91c9-9b070dd06f96",
      "name": "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ + –∫–Ω–æ–ø–∫–∏",
      "webhookId": "7a099cfe-b97f-4d20-b997-245848763007",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ\nconst item = $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1').first();\n// –ë–µ—Ä–µ–º —Ç–µ–∫—Å—Ç –¥—Ä–∞—Ñ—Ç–∞\nconst text = item.json.draft_longread || item.json.longread || \"\";\n// –ë–µ—Ä–µ–º —Å–ø–∏—Å–æ–∫ —Å—Ç–∞—Ä—ã—Ö ID (–µ—Å–ª–∏ –µ—Å—Ç—å)\nconst oldIds = item.json.approve2_longread_msg_ids || [];\n// –ë–µ—Ä–µ–º ID —Å—Ç–∞—Ä–æ–≥–æ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏\nconst oldButtonMsgId = item.json.approve2_message_id;\n\n// 3. –§—É–Ω–∫—Ü–∏—è —Ä–∞–∑–±–∏–≤–∫–∏ –Ω–∞ —á–∞–Ω–∫–∏ (3800 —Å–∏–º–≤–æ–ª–æ–≤ —Å –∑–∞–ø–∞—Å–æ–º)\nfunction splitSmart(str, max) {\n  const res = [];\n  const parts = str.split(/\\n\\s*\\n/);\n  let buf = \"\";\n  for (const p of parts) {\n    if ((buf.length + p.length + 2) > max) { res.push(buf.trim()); buf = \"\"; }\n    buf = buf ? buf + \"\\n\\n\" + p : p;\n  }\n  if (buf) res.push(buf.trim());\n  return res.length ? res : [str];\n}\n\nconst chunks = splitSmart(text, 3800);\n\n// –õ–û–ì–ò–ö–ê –†–ï–®–ï–ù–ò–Ø:\n// –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º (Edit) –¢–û–õ–¨–ö–û –µ—Å–ª–∏:\n// 1. –°—Ç–∞—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—ã–ª–æ —Ä–æ–≤–Ω–æ –æ–¥–Ω–æ.\n// 2. –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–æ–∂–µ –≤–ª–µ–∑–∞–µ—Ç –≤ –æ–¥–∏–Ω —á–∞–Ω–∫.\nconst canEdit = (oldIds.length === 1) && (chunks.length === 1);\n\nreturn {\n  json: {\n    can_edit: canEdit,\n    target_msg_id: oldIds[0],      // –î–ª—è –≤–µ—Ç–∫–∏ Edit\n    old_ids: oldIds,               // –ú–∞—Å—Å–∏–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤ –≤–µ—Ç–∫–µ Rebuild\n    old_btn_id: oldButtonMsgId,    // –°—Ç–∞—Ä–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è\n    chunks: chunks                 // –ù–æ–≤—ã–µ –∫—É—Å–∫–∏ —Ç–µ–∫—Å—Ç–∞\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        688,
        3296
      ],
      "id": "0b53e8ba-959a-49e4-8c19-1c638e2f7671",
      "name": "–ö–æ–¥: –ê–Ω–∞–ª–∏–∑ (Edit –∏–ª–∏ Rebuild?)"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "keyValue": "={{ $('–ë–î: –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é –ø—Ä–∞–≤–∫—É').item.json.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -144,
        3760
      ],
      "id": "deb168e9-55da-4aa7-83ef-368081af4466",
      "name": "–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ2",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ2').item.json.approve2_message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "=‚úÖ –ö–∞—Ä—Ç–∏–Ω–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞. –ü—É–±–ª–∏–∫—É–µ–º?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è",
                    "additionalFields": {
                      "callback_data": "={{ 'A2|' + $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ2').item.json.id }}"
                    }
                  },
                  {
                    "text": "‚úçÔ∏è –ü—Ä–∞–≤–∫–∏",
                    "additionalFields": {
                      "callback_data": "={{ 'R2|' + $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ2').item.json.id }}"
                    }
                  },
                  {
                    "text": "üóëÔ∏è –°–∫–∏–ø",
                    "additionalFields": {
                      "callback_data": "={{ 'X2|' + $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ2').item.json.id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        720,
        3760
      ],
      "id": "8e82bc60-9de9-4cd1-9a9a-8ae5ff3b21de",
      "name": "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ + –∫–Ω–æ–ø–∫–∏1",
      "webhookId": "7a099cfe-b97f-4d20-b997-245848763007",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.message_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        112,
        3552
      ],
      "id": "fd9f419f-5be3-4244-b473-d483100b4946",
      "name": "TG: –£–¥–∞–ª–∏—Ç—å –æ—Ç–≤–µ—Ç —é–∑–µ—Ä–∞2",
      "webhookId": "20292647-c666-42b4-9861-a3d764e67bf7",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ2').item.json.rewrite2_question_message_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        112,
        3952
      ],
      "id": "f183b3eb-8103-44c2-a3bd-2b2525d30cee",
      "name": "TG: –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å –±–æ—Ç–∞2",
      "webhookId": "00cd84ae-bd3b-4485-8fbb-efdbb3c5c568",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "keyValue": "={{ $('–ë–î: –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é –ø—Ä–∞–≤–∫—É').first().json.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        416,
        4208
      ],
      "id": "f7ac1374-165f-494d-8df9-3bd186652657",
      "name": "–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ3",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.message_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        784,
        4112
      ],
      "id": "9652354c-e091-4bec-a1dc-583e34aeb419",
      "name": "TG: –£–¥–∞–ª–∏—Ç—å –æ—Ç–≤–µ—Ç —é–∑–µ—Ä–∞3",
      "webhookId": "20292647-c666-42b4-9861-a3d764e67bf7",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $json.rewrite2_request_message_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        800,
        4304
      ],
      "id": "b4fe2be9-890b-4bc2-9bf9-1d3e07f3bb9e",
      "name": "TG: –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å –±–æ—Ç–∞3",
      "webhookId": "00cd84ae-bd3b-4485-8fbb-efdbb3c5c568",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $json.approve2_message_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        784,
        4496
      ],
      "id": "4e6753c9-84d0-49b0-bc92-f3d38b64290a",
      "name": "TG: –£–¥–∞–ª–∏—Ç—å –º–µ–Ω—é –≤—Ä–µ–º–µ–Ω–∏1",
      "webhookId": "5661c516-167a-4dc9-9b6d-cbb31be16d42",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "publish_recipes",
        "filters": {
          "conditions": [
            {
              "keyName": "is_active",
              "condition": "eq",
              "keyValue": "true"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2080,
        2624
      ],
      "id": "3556aaed-2c44-4ad6-9c0c-ddd49589679e",
      "name": "–ë–î: –ü–æ–ª—É—á–∏—Ç—å –†–µ—Ü–µ–ø—Ç—ã",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1. –ë–µ—Ä–µ–º —Ä–µ—Ü–µ–ø—Ç—ã (–≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ)\nconst recipes = $input.all().map(r => r.json);\n\n// 2. –ò–©–ï–ú ID –ù–û–í–û–°–¢–ò (–£–º–Ω—ã–π –ø–æ–∏—Å–∫)\nlet newsId;\n\ntry {\n  // –ü–æ–ø—ã—Ç–∫–∞ 1: –í–∑—è—Ç—å –∏–∑ –Ω–∞—á–∞–ª–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è (–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –¥–ª—è –±–æ–µ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞)\n  // .first() –±–µ—Ä–µ—Ç –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ –∏—Ö —Ç–∞–º –º–Ω–æ–≥–æ\n  const normItem = $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').first();\n  if (normItem && normItem.json && normItem.json.news_id) {\n     newsId = normItem.json.news_id;\n  }\n} catch (error) {\n  // –û—à–∏–±–∫–∞ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –º—ã —Ç–µ—Å—Ç–∏—Ä—É–µ–º –Ω–æ–¥—É –æ—Ç–¥–µ–ª—å–Ω–æ –∏ n8n –Ω–µ –≤–∏–¥–∏—Ç –ø—Ä–æ—à–ª—ã–µ —à–∞–≥–∏\n  console.log('–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º: –ù–æ–¥–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');\n}\n\n// –ü–æ–ø—ã—Ç–∫–∞ 2: –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ (–∏–ª–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º), –±–µ—Ä–µ–º ID –∏–∑ —Ä–µ—Ü–µ–ø—Ç–∞ (–µ—Å–ª–∏ –≤–¥—Ä—É–≥ –æ–Ω —Ç–∞–º –µ—Å—Ç—å) \n// –∏–ª–∏ —Å—Ç–∞–≤–∏–º –ó–ê–ì–õ–£–®–ö–£, —á—Ç–æ–±—ã —Ç—ã —É–≤–∏–¥–µ–ª, —á—Ç–æ –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç.\nif (!newsId) {\n   newsId = \"00000000-0000-0000-0000-000000000000\"; // –¢–µ—Å—Ç–æ–≤—ã–π ID (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ undefined)\n}\n\n// 3. –ü–û–õ–£–ß–ê–ï–ú –î–ê–¢–£\nlet baseDateStr;\ntry {\n   // –ü—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å –¥–∞—Ç—É –æ—Ç AI (–≤–µ—Ç–∫–∞ –ü–ª–∞–Ω)\n   baseDateStr = $('AI: –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã').first().json.output;\n} catch (e) {\n   // –ï—Å–ª–∏ –≤–µ—Ç–∫–∞ \"–°–µ–π—á–∞—Å\" –∏–ª–∏ –æ—à–∏–±–∫–∞ ‚Äî –±–µ—Ä–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è\n   baseDateStr = new Date().toISOString();\n}\nconst baseDate = new Date(baseDateStr);\n\nconst results = [];\n\n// 4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–∞–¥–∞—á–∏\nfor (const recipe of recipes) {\n  let publishAt = new Date(baseDate);\n  \n  // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É (–µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –≥–ª–∞–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)\n  if (!recipe.is_main) {\n    publishAt.setHours(publishAt.getHours() + (recipe.delay_hours || 0));\n  }\n\n  results.push({\n    json: {\n      news_id: newsId,\n      platform: recipe.platform,\n      status: 'queued',\n      publish_at: publishAt.toISOString(),\n      created_at: new Date().toISOString()\n    }\n  });\n}\n\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1888,
        2624
      ],
      "id": "0f90be41-ca9a-42fb-aa35-24eea3c268cd",
      "name": "–ö–æ–¥: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Jobs"
    },
    {
      "parameters": {
        "tableId": "publish_jobs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "news_id",
              "fieldValue": "={{ $json.news_id }}"
            },
            {
              "fieldId": "platform",
              "fieldValue": "={{ $json.platform }}"
            },
            {
              "fieldId": "status",
              "fieldValue": "={{ $json.status }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $json.created_at }}"
            },
            {
              "fieldId": "publish_at",
              "fieldValue": "={{ $json.publish_at }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1664,
        2624
      ],
      "id": "6fe344bc-89a6-4dd3-b61b-f3dec88e4f68",
      "name": "Create a row",
      "executeOnce": false,
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "publish_recipes",
        "filters": {
          "conditions": [
            {
              "keyName": "is_active",
              "condition": "eq",
              "keyValue": "true"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -656,
        4208
      ],
      "id": "7bdf12c3-24a3-444c-8029-638a96f36319",
      "name": "–ë–î: –ü–æ–ª—É—á–∏—Ç—å –†–µ—Ü–µ–ø—Ç—ã1",
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1) Recipes\nconst recipes = $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å –†–µ—Ü–µ–ø—Ç—ã1').all().map(r => r.json);\n\n// 2) News id (take from \"–ß—Ç–æ –ø—Ä–∞–≤–∏–º?\")\nconst newsId = $('–ß—Ç–æ –ø—Ä–∞–≤–∏–º?').first().json.id;\nif (!newsId) throw new Error('news_id is missing in node \"–ß—Ç–æ –ø—Ä–∞–≤–∏–º?\" (field: id)');\n\n// 3) Base datetime: take from AI node if possible\nconst aiItem = $('AI: –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã').first().json;\nconst aiStr = aiItem && aiItem.output ? String(aiItem.output) : '';\n\nlet baseMs = Date.parse(aiStr);\nif (Number.isNaN(baseMs)) {\n  baseMs = Date.now();\n}\n\n// 4) Build jobs\nconst nowIso = new Date().toISOString();\nconst results = [];\n\nfor (const recipe of recipes) {\n  const delayHours = Number(recipe.delay_hours || 0);\n  const isMain = recipe.is_main === true;\n\n  const publishMs = isMain ? baseMs : (baseMs + delayHours * 3600 * 1000);\n\n  results.push({\n    json: {\n      news_id: newsId,\n      platform: recipe.platform,\n      status: 'queued',\n      publish_at: new Date(publishMs).toISOString(),\n      created_at: nowIso,\n    }\n  });\n}\n\nreturn results;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -448,
        4208
      ],
      "id": "1727e05b-0c21-4cf7-924d-c13d461d0b86",
      "name": "–ö–æ–¥: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Jobs1"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json.news_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status",
              "fieldValue": "approved_for_publish"
            },
            {
              "fieldId": "rewrite2_state",
              "fieldValue": "={{ null }}"
            },
            {
              "fieldId": "approve2_decision",
              "fieldValue": "approved"
            },
            {
              "fieldId": "approve2_decided_at",
              "fieldValue": "={{ $now }}"
            },
            {
              "fieldId": "approve2_decided_by",
              "fieldValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.from_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -32,
        4208
      ],
      "id": "74e00d1d-5384-453d-a5a1-1e12c28a4732",
      "name": "–ë–î: –°—Ç–∞—Ç—É—Å Approved1",
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Article context (short):\n{{ ($json.draft_announce || '').slice(0, 900) }}\n\nAdmin visual notes (optional, short):\n{{ (($('–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç').item.json.text || '') + '').slice(0, 600) }}\n\n",
        "options": {
          "systemMessage": "–°–æ—Å—Ç–∞–≤—å –∫–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–æ–º—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —É—á–∏—Ç—ã–≤–∞—è –∫–æ–Ω—Ç–µ–∫—Å—Ç –∞–Ω–æ–Ω—Å–∞ –∏ –∑–∞–º–µ—Ç–∫–∏ –∞–¥–º–∏–Ω–∞. "
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -944,
        3760
      ],
      "id": "b75c63d0-65f6-44d3-acf7-03053c6bfb78",
      "name": "AI: –ü—Ä–æ–º—Ç –¥–ª—è DALL-E",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=–¢—ã ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä Telegram-–∫–∞–Ω–∞–ª–∞ –ø—Ä–æ –æ—Ö–æ—Ç—É.\n\n–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∞–Ω–æ–Ω—Å, —É–ª—É—á—à–∏–≤ —Å—Ç–∏–ª—å –∏ –∏–Ω—Ç—Ä–∏–≥—É, \n–ù–û –°–¢–†–û–ì–û –°–û–ë–õ–Æ–î–ê–Ø –°–¢–†–£–ö–¢–£–†–£ –ò –§–û–†–ú–ê–¢ –í–´–•–û–î–ê.\n\n–°–¢–†–£–ö–¢–£–†–ê –í–´–•–û–î–ù–û–ì–û –¢–ï–ö–°–¢–ê (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û):\n1) –ò–Ω—Ç—Ä–∏–≥–∞ ‚Äî 2‚Äì3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.\n2) –•—ç—à—Ç–µ–≥–∏ ‚Äî —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏, 2‚Äì3 —Ç–µ–≥–∞, –±–µ–∑ #–û—Ö–æ—Ç–∞.\n3) –ü—Ä–∏–∑—ã–≤ ‚Äî –°–¢–†–û–ì–û –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–æ–π.\n\n–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ê–í–ò–õ–ê (–ù–ê–†–£–®–ê–¢–¨ –ó–ê–ü–†–ï–©–ï–ù–û):\n- –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–∏–∑—ã–≤–æ–º.\n- –ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–º–≤–æ–ª –≤—Å–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–≤–æ–µ—Ç–æ—á–∏–µ–º (:).\n- –ü–æ—Å–ª–µ –¥–≤–æ–µ—Ç–æ—á–∏—è –ù–ò–ß–ï–ì–û –Ω–µ –ø–∏—Å–∞—Ç—å: –Ω–∏ –ø—Ä–æ–±–µ–ª–æ–≤, –Ω–∏ —Å—Å—ã–ª–æ–∫, –Ω–∏ —Å–∏–º–≤–æ–ª–æ–≤.\n- –ó–∞–ø—Ä–µ—â–µ–Ω–æ —É–¥–∞–ª—è—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω—è—Ç—å —Ñ–æ—Ä–º–∞—Ç –ø—Ä–∏–∑—ã–≤–∞.\n- –ï—Å–ª–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–∑—ã–≤ –±—ã–ª —É—Ç–µ—Ä—è–Ω ‚Äî –í–û–°–°–¢–ê–ù–û–í–ò –µ–≥–æ.\n\n–î–û–ü–£–°–¢–ò–ú–´–ï –í–ê–†–ò–ê–ù–¢–´ –ü–†–ò–ó–´–í–ê (–≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω):\n- –ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ:\n- –ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø–æ —Å—Å—ã–ª–∫–µ:\n- –ü–æ–ª–Ω—ã–π —Ä–∞–∑–±–æ—Ä —Å–∏—Ç—É–∞—Ü–∏–∏:\n- –ß–∏—Ç–∞–π—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –Ω–∞ —Å–∞–π—Ç–µ:\n\n–û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:\n- –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ ‚Äî –Ω–µ –±–æ–ª–µ–µ 900 —Å–∏–º–≤–æ–ª–æ–≤.\n- –¢–æ–Ω: –∂–∏–≤–æ–π, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –±–µ–∑ –≤–æ–¥—ã.\n\n–ò–°–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï:\n–ò—Å—Ö–æ–¥–Ω—ã–π –∞–Ω–æ–Ω—Å:\n{{ $json.draft_announce }}\n\n–ü–æ–∂–µ–ª–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n{{ $('–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç').item.json.text }}\n\n–ü–ï–†–ï–î –í–´–í–û–î–û–ú:\n–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –ø—Ä–∏–∑—ã–≤ –∏ —Ç–µ–∫—Å—Ç –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –¥–≤–æ–µ—Ç–æ—á–∏–µ–º.\n\n–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –∞–Ω–æ–Ω—Å–∞. –ë–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -1024,
        2896
      ],
      "id": "ca49468e-f74c-4750-bde5-8e61d1b9feae",
      "name": "AI: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∞–Ω–æ–Ω—Å",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=–°–µ–π—á–∞—Å: {{ $now }}. –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å +3 (–ú–æ—Å–∫–≤–∞).\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª: \n{{ $('–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç').item.json.text }}\n\n–ó–ê–î–ê–ß–ê:\n–ü–µ—Ä–µ–≤–µ–¥–∏ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –≤ –¥–∞—Ç—É —Ñ–æ—Ä–º–∞—Ç–∞ ISO 8601 (YYYY-MM-DDTHH:mm:ssZ).\n–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª \"–∑–∞–≤—Ç—Ä–∞ –≤ 10\", —Å—á–∏—Ç–∞–π –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.\n–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û —Å—Ç—Ä–æ–∫—É –¥–∞—Ç—ã.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -976,
        4208
      ],
      "id": "deafa14b-df87-46b5-8cda-a5ae912e6098",
      "name": "AI: –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=–ò—Å—Ö–æ–¥–Ω—ã–π –ª–æ–Ω–≥—Ä–∏–¥:\n{{ $json.draft_longread }}\n\n–ó–ê–î–ê–ß–ê:\n–ü–µ—Ä–µ–ø–∏—à–∏ –ª–æ–Ω–≥—Ä–∏–¥, —É—á–∏—Ç—ã–≤–∞—è –ø–æ–∂–µ–ª–∞–Ω–∏—è:\n{{ $('–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç').item.json.text }}\n\n–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û markdown —Ç–µ–∫—Å—Ç.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        -1008,
        3296
      ],
      "id": "de9885c6-2597-475c-a259-ca57a3de405a",
      "name": "AI: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ª–æ–Ω–≥—Ä–∏–¥",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "6b13aa61-d9e0-4f45-88ab-802474075546",
              "leftValue": "={{ $json.callback_query.data }}",
              "rightValue": "A1",
              "operator": {
                "type": "string",
                "operation": "startsWith"
              }
            },
            {
              "id": "4596e4cd-7f55-44e4-921c-24894d4bc8b9",
              "leftValue": "={{ $json.callback_query.data }}",
              "rightValue": "X1",
              "operator": {
                "type": "string",
                "operation": "startsWith"
              }
            },
            {
              "id": "0a6c9b23-86c0-4d7b-a30d-8443a214e878",
              "leftValue": "={{ $json.callback_query.data }}",
              "rightValue": "approve",
              "operator": {
                "type": "string",
                "operation": "startsWith"
              }
            },
            {
              "id": "bb9e8a37-5b70-473e-8ac2-620a8e2261b9",
              "leftValue": "={{ $json.callback_query.data }}",
              "rightValue": "reject",
              "operator": {
                "type": "string",
                "operation": "startsWith"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -4240,
        288
      ],
      "id": "2f85773a-ad95-4498-ab5d-60042970a7e5",
      "name": "rss?"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.can_edit }}",
              "value2": true
            }
          ]
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1056,
        3296
      ],
      "id": "71ac1f68-f72a-4695-84a2-435ac61e75e7",
      "name": "IF: –ú–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç—å?"
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1').item.json.approve2_longread_msg_ids[0] }}",
        "text": "=‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: \n\n{{ $json.chunks[0] }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1232,
        2656
      ],
      "id": "345f7065-3a2d-4374-ba43-e28a2952d118",
      "name": "TG: –ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç—å (Edit)",
      "webhookId": "141c058f-8709-4061-913f-7474dc4629ab",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –£–î–ê–õ–ï–ù–ò–Æ –°–¢–ê–†–´–• –°–û–û–ë–©–ï–ù–ò–ô\nreturn $json.old_ids.map(id => ({ json: { msg_id: id } }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1552,
        3456
      ],
      "id": "4e8d9dbf-ad53-4070-b867-bbd3b0f66762",
      "name": "–ö–æ–¥: ID –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1760,
        3456
      ],
      "id": "d35f6eb6-58ca-472d-8a84-3851152a09aa",
      "name": "–¶–∏–∫–ª: –£–¥–∞–ª–µ–Ω–∏–µ"
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $json.msg_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1984,
        3600
      ],
      "id": "ccf4a46e-fcf4-4abf-8eed-f916df621743",
      "name": "TG: –£–¥–∞–ª–∏—Ç—å (Loop)",
      "webhookId": "1a976dce-b778-42a1-ab53-c8e3273e2c5c",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ (–º–∞—Å—Å–∏–≤ —á–∞–Ω–∫–æ–≤ –∏–ª–∏ —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç) –∏–∑ –Ω–æ–¥—ã –∞–Ω–∞–ª–∏–∑–∞\n// –í–∞–∂–Ω–æ: –≤ —Ç–≤–æ–µ–º —Å–ª—É—á–∞–µ –¥–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç –≤ –Ω–æ–¥–µ \"–ö–æ–¥: –ê–Ω–∞–ª–∏–∑ (Edit –∏–ª–∏ Rebuild?)\"\nconst analysisNode = $('–ö–æ–¥: –ê–Ω–∞–ª–∏–∑ (Edit –∏–ª–∏ Rebuild?)').first();\nlet chunks = analysisNode ? analysisNode.json.chunks : [];\n\n// –ó–ê–©–ò–¢–ê: –ï—Å–ª–∏ —á–∞–Ω–∫–æ–≤ –Ω–µ—Ç –∏–ª–∏ –æ–Ω–∏ –ø—É—Å—Ç—ã–µ\nif (!chunks || chunks.length === 0) {\n  return []; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ—Ç—É, —á—Ç–æ–±—ã —Ü–∏–∫–ª –Ω–µ —Å–ª–æ–º–∞–ª—Å—è\n}\n\n// 2. –§–£–ù–ö–¶–ò–Ø –û–ß–ò–°–¢–ö–ò (–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ)\n// –£–±–∏—Ä–∞–µ—Ç ```markdown –≤ –Ω–∞—á–∞–ª–µ –∏ ``` –≤ –∫–æ–Ω—Ü–µ, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å\nfunction cleanText(text) {\n  if (!text) return \"\";\n  return String(text)\n    .replace(/^```[a-z]*\\s*/i, \"\") // –£–±–∏—Ä–∞–µ—Ç ```markdown\n    .replace(/```\\s*$/, \"\")         // –£–±–∏—Ä–∞–µ—Ç ``` –≤ –∫–æ–Ω—Ü–µ\n    .trim();\n}\n\n// 3. –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏\n// –ü—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –≤—Å–µ–º —á–∞–Ω–∫–∞–º –∏ —á–∏—Å—Ç–∏–º –∫–∞–∂–¥—ã–π (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)\nreturn chunks.map((chunk, i) => {\n  const cleanChunk = cleanText(chunk);\n  \n  // –î–æ–±–∞–≤–ª—è–µ–º –Ω—É–º–µ—Ä–∞—Ü–∏—é [1/3], –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ\n  const prefix = chunks.length > 1 ? `[${i + 1}/${chunks.length}]\\n\\n` : \"\";\n  \n  return {\n    json: {\n      text: prefix + cleanChunk\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2016,
        3360
      ],
      "id": "bf95b93a-0004-4317-b214-bd49a44be0ca",
      "name": "–ö–æ–¥: –ß–∞–Ω–∫–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        2224,
        3360
      ],
      "id": "4dc693c8-0501-41ce-b2b8-fc6fb08f5fa1",
      "name": "–¶–∏–∫–ª: –û—Ç–ø—Ä–∞–≤–∫–∞"
    },
    {
      "parameters": {
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "text": "=‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: \n\n{{ $json.text }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2496,
        3520
      ],
      "id": "09e7bdf3-ce85-4083-ab1a-93fb14d4329e",
      "name": "TG: –û—Ç–ø—Ä–∞–≤–∏—Ç—å (Loop)",
      "webhookId": "4be7477a-5f4e-41ec-8d2f-7d83889ccbc8",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1').item.json.approve2_message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "=‚úÖ –õ–æ–Ω–≥—Ä–∏–¥ –æ–±–Ω–æ–≤–ª–µ–Ω. –ü—É–±–ª–∏–∫—É–µ–º –Ω–æ–≤–æ—Å—Ç—å?",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è",
                    "additionalFields": {
                      "callback_data": "={{ 'A2|' + $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1').item.json.id }}"
                    }
                  },
                  {
                    "text": "‚úçÔ∏è –ü—Ä–∞–≤–∫–∏",
                    "additionalFields": {
                      "callback_data": "={{ 'R2|' + $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1').item.json.id }}"
                    }
                  },
                  {
                    "text": "üóëÔ∏è –°–∫–∏–ø",
                    "additionalFields": {
                      "callback_data": "={{ 'X2|' + $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1').item.json.id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1440,
        2656
      ],
      "id": "1f78012b-4f54-4c01-bde6-a6992ce080ad",
      "name": "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ + –∫–Ω–æ–ø–∫–∏2",
      "webhookId": "455f169c-1494-4300-baa5-67d13265f56f",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "messageId": "={{ $('–ö–æ–¥: –ê–Ω–∞–ª–∏–∑ (Edit –∏–ª–∏ Rebuild?)').first().json.old_btn_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3424,
        3312
      ],
      "id": "ba732225-7ada-402c-8f60-ed7c49afcac8",
      "name": "TG: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–Ω–æ–ø–∫–∏",
      "webhookId": "455f169c-1494-4300-baa5-67d13265f56f",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE public.news_items\nSET\n  approve2_longread_msg_ids = $2\nWHERE id = $1;",
        "options": {
          "queryReplacement": "={{ [ $json.final_news_id, $json.final_msg_ids ] }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        4048,
        16
      ],
      "id": "b6285919-77d0-460e-adbf-a0398ad1368c",
      "name": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–Ω–≥—Ä–∏–¥ approve2_longread_msg_ids",
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE public.news_items\nSET\n  approve2_message_id = $2,\n  approve2_chat_id = $3\nWHERE id = $1;",
        "options": {
          "queryReplacement": "={{ [\n  $('–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏2').first().json.news_id,\n  $json.result.message_id,\n  $json.result.chat.id\n] }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        4544,
        16
      ],
      "id": "08e7ba2c-3cb7-4285-9fcc-0aadda551232",
      "name": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å id –∫–Ω–æ–ø–æ–∫",
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const nodeName = \"TG: –ê–ø—Ä—É–≤-2 (–ª–æ–Ω–≥—Ä–∏–¥ —á–∞—Å—Ç—å)\";\nconst allIds = [];\nlet runIndex = 0;\nlet safetyBreak = 0;\n\n// –ë–ï–°–ö–û–ù–ï–ß–ù–´–ô –¶–ò–ö–õ –ü–û –ò–°–¢–û–†–ò–ò –ó–ê–ü–£–°–ö–û–í\n// –ú—ã –±—É–¥–µ–º —Å—Ç—É—á–∞—Ç—å—Å—è –≤ n8n: \"–î–∞–π –¥–∞–Ω–Ω—ã–µ 1-–≥–æ –∫—Ä—É–≥–∞\", \"–î–∞–π –¥–∞–Ω–Ω—ã–µ 2-–≥–æ –∫—Ä—É–≥–∞\" –∏ —Ç.–¥.\nwhile(safetyBreak < 100) { // –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è\n    try {\n        // $items(–ò–º—è–ù–æ–¥—ã, –ò–Ω–¥–µ–∫—Å–í—ã—Ö–æ–¥–∞, –ò–Ω–¥–µ–∫—Å–ó–∞–ø—É—Å–∫–∞)\n        // –ü—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫—Ä—É–≥–∞ (runIndex)\n        const executionItems = $items(nodeName, 0, runIndex);\n        \n        if (!executionItems || executionItems.length === 0) {\n            break; // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî –∑–Ω–∞—á–∏—Ç –∫—Ä—É–≥–∏ –∫–æ–Ω—á–∏–ª–∏—Å—å\n        }\n\n        // –ó–∞–±–∏—Ä–∞–µ–º ID –∏–∑ —ç—Ç–æ–≥–æ –∫—Ä—É–≥–∞\n        executionItems.forEach(item => {\n            if (item.json.result && item.json.result.message_id) {\n                allIds.push(item.json.result.message_id);\n            }\n        });\n\n        runIndex++;     // –ò–¥–µ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∫—Ä—É–≥—É\n        safetyBreak++;\n    } catch (error) {\n        // –ï—Å–ª–∏ n8n –≤—ã–¥–∞–ª –æ—à–∏–±–∫—É (–Ω–µ—Ç —Ç–∞–∫–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞) ‚Äî –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è\n        break;\n    }\n}\n\n// –ü–æ–ª—É—á–∞–µ–º ID –Ω–æ–≤–æ—Å—Ç–∏ (–¥–ª—è –±–∞–∑—ã)\nlet newsId = null;\ntry {\n  newsId = $('–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏2').first().json.news_id;\n} catch(e) {}\n\nreturn {\n    json: {\n        final_news_id: newsId,\n        final_msg_ids: JSON.stringify(allIds), // –¢–µ–ø–µ—Ä—å —Ç—É—Ç –±—É–¥–µ—Ç \"[303, 304]\"\n        count: allIds.length\n    }\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3824,
        16
      ],
      "id": "1fb00de5-090f-40b0-9e17-5b3238a191fb",
      "name": "–ö–æ–¥: –°–æ–±—Ä–∞—Ç—å ID"
    },
    {
      "parameters": {
        "jsCode": "const nodeName = \"TG: –û—Ç–ø—Ä–∞–≤–∏—Ç—å (Loop)\";\nconst allIds = [];\nlet runIndex = 0;\nlet safetyBreak = 0;\n\n// 1. –ë–ï–°–ö–û–ù–ï–ß–ù–´–ô –¶–ò–ö–õ –ü–û –ò–°–¢–û–†–ò–ò –ó–ê–ü–£–°–ö–û–í\nwhile(safetyBreak < 100) {\n    try {\n        // $items(–ò–º—è–ù–æ–¥—ã, –ò–Ω–¥–µ–∫—Å–í—ã—Ö–æ–¥–∞, –ò–Ω–¥–µ–∫—Å–ó–∞–ø—É—Å–∫–∞)\n        const executionItems = $items(nodeName, 0, runIndex);\n        \n        if (!executionItems || executionItems.length === 0) {\n            break;\n        }\n\n        // –ó–∞–±–∏—Ä–∞–µ–º ID\n        executionItems.forEach(item => {\n            if (item.json.result && item.json.result.message_id) {\n                allIds.push(item.json.result.message_id);\n            }\n        });\n\n        runIndex++;\n        safetyBreak++;\n    } catch (error) {\n        break;\n    }\n}\n\n// 2. –ü–æ–ª—É—á–∞–µ–º ID –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–≤—ã—à–µ –ø–æ –ø–æ—Ç–æ–∫—É)\nlet newsId = null;\ntry {\n  // –í —ç—Ç–æ–º —É—á–∞—Å—Ç–∫–µ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç –≤ –Ω–æ–¥–µ \"–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1\"\n  newsId = $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1').first().json.id;\n} catch(e) {\n  newsId = null;\n}\n\nreturn {\n    json: {\n        final_news_id: newsId,\n        final_msg_ids: JSON.stringify(allIds), \n        count: allIds.length\n    }\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2496,
        3312
      ],
      "id": "8099e907-8091-4ded-a68a-256d093c2b36",
      "name": "–ö–æ–¥: –°–æ–±—Ä–∞—Ç—å ID (Rebuild)"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE public.news_items\nSET\n  approve2_longread_msg_ids = $2\nWHERE id = $1;",
        "options": {
          "queryReplacement": "={{ [ $json.final_news_id, $json.final_msg_ids ] }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        2720,
        3312
      ],
      "id": "db4c3b1a-8355-458b-a6da-75e07fa52d42",
      "name": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–Ω–≥—Ä–∏–¥ (Rebuild)",
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE public.news_items\nSET\n  approve2_message_id = $2,\n  approve2_chat_id = $3\nWHERE id = $1;",
        "options": {
          "queryReplacement": "={{ [\n  $('–ö–æ–¥: –°–æ–±—Ä–∞—Ç—å ID (Rebuild)').first().json.final_news_id,\n  $json.result.message_id,\n  $json.result.chat.id\n] }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        3168,
        3312
      ],
      "id": "2742cc63-1e05-4e6b-977d-7b903c09a8fa",
      "name": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–Ω–æ–ø–∫—É (Rebuild)",
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤').first().json.approve_chat_id }}",
        "text": "‚úÖ –õ–æ–Ω–≥—Ä–∏–¥ –æ–±–Ω–æ–≤–ª–µ–Ω. –ü—É–±–ª–∏–∫—É–µ–º?",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è",
                    "additionalFields": {
                      "callback_data": "={{ 'A2|' + $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1').first().json.id }}"
                    }
                  },
                  {
                    "text": "‚úçÔ∏è –ü—Ä–∞–≤–∫–∏",
                    "additionalFields": {
                      "callback_data": "={{ 'R2|' + $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1').first().json.id }}"
                    }
                  },
                  {
                    "text": "üóëÔ∏è –í –∫–æ—Ä–∑–∏–Ω—É",
                    "additionalFields": {
                      "callback_data": "={{ 'X2|' + $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1').first().json.id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2944,
        3312
      ],
      "id": "f1efe9fa-d6c9-4657-89d8-b7714cffd7bc",
      "name": "TG: –ê–ø—Ä—É–≤-2 (–ù–û–í–´–ï –∫–Ω–æ–ø–∫–∏)1",
      "webhookId": "d8c99276-b352-4077-831b-02939ef152e6",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "efd22d68-eb0e-41f4-b904-ed8f72126447",
              "leftValue": "={{ $json.title }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -1424,
        1584
      ],
      "id": "e883ef90-c983-4884-b310-b3f2ff9c5443",
      "name": "–ï—Å–ª–∏: –£–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–∞–≤–∫–∞?"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT title FROM public.news_items\nWHERE rewrite2_state IS NOT NULL\nAND id != $1\nLIMIT 1;",
        "options": {
          "queryReplacement": "={{ [ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.news_id ] }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1840,
        1584
      ],
      "id": "807b697f-4b18-44c5-aa73-4ac0d252e0a3",
      "name": "–ë–î: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('Telegram Trigger').first().json.callback_query.message.chat.id }}",
        "messageId": "={{ $('Telegram Trigger').first().json.callback_query.message.message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "=–ù–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–≤–µ –Ω–æ–≤–æ—Å—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!\n–°–µ–π—á–∞—Å –≤ —Ä–∞–±–æ—Ç–µ:\n{{ $json.title }}.  \n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≤–µ—Ä—à–∏—Ç–µ –µ—ë, –∞ –ø–æ—Ç–æ–º –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —ç—Ç–æ–π.",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üîô –ü–æ–Ω—è–ª",
                    "additionalFields": {
                      "callback_data": "={{ 'CancelEdit|' + $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.news_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1136,
        1568
      ],
      "id": "325eb16a-c3e9-4455-9c97-0de5c39be5fd",
      "name": "TG: –û—à–∏–±–∫–∞ (–ó–∞–Ω—è—Ç–æ)",
      "webhookId": "3413bd5b-5e01-41c8-b319-7c58070d1657",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT title\nFROM public.news_items\nWHERE\n  status::text IN ('drafts_ready', 'needs_review', 'approved_for_adaptation', 'generated')\n  AND LOWER(COALESCE(approve2_decision,'')) NOT IN ('approved','skip')\nLIMIT 1;",
        "options": {
          "queryReplacement": "={{ [ $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.news_id ] }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2672,
        -80
      ],
      "id": "9acef0d0-a584-4644-a758-bb2eb0447562",
      "name": "–ë–î: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–∏ RSS",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "54f6c82f-0878-4e70-b140-1657065c18b6",
              "leftValue": "={{ $json.title }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -2464,
        -80
      ],
      "id": "3c967238-6645-49b0-aa08-12166dac4ee0",
      "name": "–ï—Å–ª–∏: –û—á–µ—Ä–µ–¥—å –∑–∞–Ω—è—Ç–∞?"
    },
    {
      "parameters": {
        "operation": "editMessageText",
        "chatId": "={{ $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.tg_chat_id }}",
        "messageId": "={{ $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.tg_message_id }}",
        "replyMarkup": "inlineKeyboard",
        "text": "={{ $('Telegram Trigger').item.json.callback_query.message.text }}\n\n‚õî <b>–û—á–µ—Ä–µ–¥—å –∞–ø–ø—Ä—É–≤–∞ –∑–∞–Ω—è—Ç–∞!</b>\n–í —Ä–∞–±–æ—Ç–µ –≤–∏—Å–∏—Ç –Ω–æ–≤–æ—Å—Ç—å:\nüëâ <b>{{ $json.title }}</b>\n–°–Ω–∞—á–∞–ª–∞ –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ –µ—ë –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ –∫–æ—Ä–∑–∏–Ω—É, –∑–∞—Ç–µ–º –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å —Å—é–¥–∞.",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞",
                    "additionalFields": {
                      "callback_data": "={{ 'A1|' + $('–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ').item.json.news_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -2208,
        -96
      ],
      "id": "f134cb09-1e42-4de2-a871-33193e7cce29",
      "name": "TG: –û—à–∏–±–∫–∞ –æ—á–µ—Ä–µ–¥–∏",
      "webhookId": "a20fd838-781f-4366-b76f-016e80990532",
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.telegram.org/bot8509009391:AAGBWp-mq4OGs7WZJH0umlu8-0JORZc_H7A/editMessageMedia",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "chat_id",
              "value": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ2').item.json.approve2_chat_id }}"
            },
            {
              "name": "message_id",
              "value": "={{ $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ2').item.json.approve2_photo_message_id }}"
            },
            {
              "name": "media",
              "value": "={{ JSON.stringify({ type: 'photo', media: 'attach://photo', caption: $('–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ2').item.json.title || '', parse_mode: 'HTML' }) }}"
            },
            {
              "parameterType": "formBinaryData",
              "name": "photo",
              "inputDataFieldName": "photo"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        288,
        3760
      ],
      "id": "d3f91846-03cb-48d8-a882-49538f3ab68a",
      "name": "HTTP Request1",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.news_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "approve2_decision",
              "fieldValue": "skip"
            },
            {
              "fieldId": "approve2_decided_at",
              "fieldValue": "={{ $now }}"
            },
            {
              "fieldId": "approve2_decided_by",
              "fieldValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.from_id }}"
            },
            {
              "fieldId": "rewrite2_state",
              "fieldValue": "={{ null }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1856,
        2032
      ],
      "id": "19dd4e09-04b0-42fb-ad61-7d785939c547",
      "name": "–ë–î: –°–∫–∏–ø (X2)",
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "news_items",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.news_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "approve2_decision",
              "fieldValue": "approved"
            },
            {
              "fieldId": "approve2_decided_at",
              "fieldValue": "={{ $now }}"
            },
            {
              "fieldId": "approve2_decided_by",
              "fieldValue": "={{ $('–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è').item.json.from_id }}"
            },
            {
              "fieldId": "status",
              "fieldValue": "approved_for_publish"
            },
            {
              "fieldId": "rewrite2_state",
              "fieldValue": "={{ null }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1472,
        2624
      ],
      "id": "5beb55a5-4695-4d0d-ab91-ef8decfb5f8f",
      "name": "–ë–î: –°—Ç–∞—Ç—É—Å Approved",
      "executeOnce": true,
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "tableId": "publish_jobs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "news_id",
              "fieldValue": "={{ $('–ë–î: –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é –ø—Ä–∞–≤–∫—É').first().json.id }}"
            },
            {
              "fieldId": "platform",
              "fieldValue": "={{ $json.platform }}"
            },
            {
              "fieldId": "status",
              "fieldValue": "={{ $json.status }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $json.created_at }}"
            },
            {
              "fieldId": "publish_at",
              "fieldValue": "={{ $json.publish_at }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -256,
        4208
      ],
      "id": "1fd51117-1fc5-4d34-88ee-5b59bf6addb6",
      "name": "–°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏",
      "executeOnce": false,
      "credentials": {
        "supabaseApi": {
          "id": "0jybqWrEmbw0Wb5i",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ca9b9188-a581-4b59-a2f4-9297a97eae41",
              "name": "announce",
              "value": "={{ [$json.draft_title || $json.title || '', $json.announce || ''].filter(v => String(v||'').trim()).join('\\n\\n') }}",
              "type": "string"
            },
            {
              "id": "ad4a7d24-f9be-456d-8fbf-dfa3528bf438",
              "name": "longread_text",
              "value": "={{ [$json.draft_title || $json.title || '', $json.longread_text || ''].filter(v => String(v||'').trim()).join('\\n\\n') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1664,
        304
      ],
      "id": "d706819c-b89d-457f-a691-e7a545e37c67",
      "name": "+title"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=TEXT:\n{{ $json.cleanedText }}",
        "options": {
          "systemMessage": "={{ $('–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–º—Ç—ã').item.json.prompts.rewrite_title }}\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        384,
        -416
      ],
      "id": "7c1d1f09-4187-46ce-951d-b925d1b1de94",
      "name": "–î—Ä–∞—Ñ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE public.news_items\nSET draft_title = $2,\n    updated_at = now()\nWHERE id = $1\nRETURNING\n  id, title, draft_title, canonical_url, source_name, rss_summary, published_at,\n  gate1_decision, gate1_score, gate1_tags, gate1_reason;\n",
        "options": {
          "queryReplacement": "={{ [\n  $('–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏').first().json.news_id,\n  $json.draft_title || $('–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏').first().json.title || ''\n] }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        944,
        -416
      ],
      "id": "6cde73fb-096a-439a-838a-9c79d6e46e1a",
      "name": "update –¥—Ä–∞—Ñ—Ç",
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const raw =\n  $json.output ??\n  $json.text ??\n  $json.response ??\n  $json.data ??\n  $json.choices?.[0]?.message?.content ??\n  \"\";\n\n// If agent returned JSON string accidentally, try to parse and extract title-like field\nlet title = \"\";\nif (typeof raw === \"string\") {\n  const s = raw.trim();\n  try {\n    const obj = JSON.parse(s);\n    title =\n      String(obj.draft_title ?? obj.title ?? obj.output ?? \"\").trim();\n  } catch (e) {\n    title = s;\n  }\n} else {\n  title = String(raw ?? \"\").trim();\n}\n\n// Hard cleanup (one line, no quotes)\ntitle = title.replace(/\\s+/g, \" \").replace(/^[\"'¬´¬ª]+|[\"'¬´¬ª]+$/g, \"\").trim();\n\n// Fallback if empty\nif (!title) title = String($('–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏').first().json.title ?? \"\").trim();\n\nreturn [\n  {\n    json: {\n      ...$json,\n      draft_title: title\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        704,
        -416
      ],
      "id": "fa77bf97-8ff0-4eac-91e8-561823be460e",
      "name": "–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è draft title"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9756b59b-fe6b-4a9f-94a7-845885a39eaf",
              "name": "draft_title",
              "value": "={{ $('–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è draft title').item.json.draft_title }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1248,
        -416
      ],
      "id": "194f56fe-3ad0-417d-a500-e09a2f713f1a",
      "name": "–ó–∞–≥–æ–ª–æ–≤–æ–∫"
    },
    {
      "parameters": {
        "url": "={{ $json.image_url }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2304,
        -288
      ],
      "id": "73fa18a5-8e2d-451a-abec-81195f5941d2",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "model": "openai/gpt-5.2",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        384,
        -208
      ],
      "id": "470a9829-581e-45c4-96c5-06ebd6b6fdeb",
      "name": "r. draft title",
      "credentials": {
        "openRouterApi": {
          "id": "OPxPNafAYGtjuKlH",
          "name": "AI News"
        }
      }
    },
    {
      "parameters": {
        "model": "openai/gpt-5.2",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        480,
        176
      ],
      "id": "81ebd813-1498-49a5-a29c-acb941af8128",
      "name": "r. draft anounce",
      "credentials": {
        "openRouterApi": {
          "id": "OPxPNafAYGtjuKlH",
          "name": "AI News"
        }
      }
    },
    {
      "parameters": {
        "model": "openai/gpt-5.2",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        448,
        656
      ],
      "id": "aef6edc8-7485-4f36-90a5-b8c46a759c11",
      "name": "r. draft longrid",
      "credentials": {
        "openRouterApi": {
          "id": "OPxPNafAYGtjuKlH",
          "name": "AI News"
        }
      }
    },
    {
      "parameters": {
        "model": "openai/gpt-5.2",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        592,
        1280
      ],
      "id": "d7ec1e74-77b0-4d77-a457-8ea9cbfebbeb",
      "name": "r. draft pic",
      "credentials": {
        "openRouterApi": {
          "id": "OPxPNafAYGtjuKlH",
          "name": "AI News"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const msg = $json.choices?.[0]?.message || {};\nconst dataUrl =\n  msg.images?.[0]?.image_url?.url ||\n  msg.images?.[0]?.imageUrl?.url;\n\nif (!dataUrl || !dataUrl.startsWith(\"data:\")) {\n  throw new Error(\"No image data URL\");\n}\n\nconst comma = dataUrl.indexOf(\",\");\nconst meta = dataUrl.slice(5, comma); // \"image/png;base64\"\nconst mimeType = meta.split(\";\")[0];\nconst base64 = dataUrl.slice(comma + 1);\n\nconst bytes = Math.floor(base64.length * 3 / 4);\nconst mb = +(bytes / 1024 / 1024).toFixed(2);\n\nreturn {\n  json: {\n    size_mb: mb,\n    caption: msg.content || \"\"\n  },\n  binary: {\n    photo: {\n      data: base64,\n      mimeType: mimeType,\n      fileName: \"img.png\"\n    }\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1200,
        1008
      ],
      "id": "0710c55e-479f-4d89-80f2-e5c50ad31243",
      "name": "DataURL -> Binary1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "HTTP-Referer",
              "value": "https://n8n.io"
            },
            {
              "name": "X-Title",
              "value": "n8n-dev"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={ \"model\": \"google/gemini-2.5-flash-image\",\n  \"messages\": [{ \"role\": \"user\", \"content\": \"{{ $json.output }}\" }],\n  \"modalities\": [\"image\", \"text\"],\n  \"image_config\": {\n    \"aspect_ratio\": \"16:9\",\n    \"image_size\": \"1K\"\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        960,
        1008
      ],
      "id": "4021cc15-ab6b-4103-b37e-42475e564004",
      "name": "OpenRouter: Image",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "credentials": {
        "httpHeaderAuth": {
          "id": "Ujxf37NtSZLQ3mZC",
          "name": "Openrouter API"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "prompt-field",
              "name": "image_prompt",
              "value": "={{ $('–ü—Ä–æ–º—Ç 3. –ò–ò: –ö–∞—Ä—Ç–∏–Ω–∫–∞').item.json.output }}",
              "type": "string"
            },
            {
              "id": "url-field",
              "name": "image_url",
              "value": "={{ $json.url }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4016,
        2576
      ],
      "id": "1c206c52-cde0-40f4-9c2d-895de0e7dd6b",
      "name": "image_url1"
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $('–ë–î: –ß–∞—Ç—ã Telegram').first().json.approve_chat_id }}",
        "binaryData": true,
        "binaryPropertyName": "photo",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1472,
        1008
      ],
      "id": "ed3ae1eb-ad9f-410f-8d05-8de789d44196",
      "name": "TG: –ê–ø—Ä—É–≤-2 (—Ñ–æ—Ç–æ)1",
      "webhookId": "0a567f92-1cda-4ab8-affd-8cf9ba927238",
      "retryOnFail": true,
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE public.news_items\nSET \n  approve2_photo_message_id = $2,\n  draft_image_file_id = $3\nWHERE id = $1;",
        "options": {
          "queryReplacement": "={{ [ \n  $('–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏').first().json.news_id, \n  $json.result.message_id, \n  $json.result.photo.slice(-1)[0].file_id \n] }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1648,
        1008
      ],
      "id": "4357a95d-5c39-406e-85b7-cce65f5f019f",
      "name": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ID —Ñ–æ—Ç–æ1",
      "credentials": {
        "postgres": {
          "id": "Apw2GZOwP2Hlrwwo",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "model": "openai/gpt-5.2",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -1008,
        3520
      ],
      "id": "1dc4c475-2033-497f-a7cf-329c455bb62a",
      "name": "r. gpt 5.2",
      "credentials": {
        "openRouterApi": {
          "id": "OPxPNafAYGtjuKlH",
          "name": "AI News"
        }
      }
    },
    {
      "parameters": {
        "model": "openai/gpt-5.2",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -944,
        3952
      ],
      "id": "a6f6c9c1-cb0e-42f5-b7a1-7ffd84a42e95",
      "name": "r. gpt 5.2 (1)",
      "credentials": {
        "openRouterApi": {
          "id": "OPxPNafAYGtjuKlH",
          "name": "AI News"
        }
      }
    },
    {
      "parameters": {
        "model": "openai/gpt-5.2",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -1024,
        3104
      ],
      "id": "2a8003d1-6e5f-4ad2-be24-2580bf65be17",
      "name": "r. gpt 5.2 (2)",
      "credentials": {
        "openRouterApi": {
          "id": "OPxPNafAYGtjuKlH",
          "name": "AI News"
        }
      }
    },
    {
      "parameters": {
        "model": "openai/gpt-5-nano",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -976,
        4432
      ],
      "id": "f0e79cd5-ef03-4b6e-a183-e0a2bbd6ed1e",
      "name": "r. gpt 5  nano",
      "credentials": {
        "openRouterApi": {
          "id": "OPxPNafAYGtjuKlH",
          "name": "AI News"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const msg = $json.choices?.[0]?.message || {};\nconst dataUrl =\n  msg.images?.[0]?.image_url?.url ||\n  msg.images?.[0]?.imageUrl?.url;\n\nif (!dataUrl || !dataUrl.startsWith(\"data:\")) {\n  throw new Error(\"No image data URL\");\n}\n\nconst comma = dataUrl.indexOf(\",\");\nconst meta = dataUrl.slice(5, comma); // \"image/png;base64\"\nconst mimeType = meta.split(\";\")[0];\nconst base64 = dataUrl.slice(comma + 1);\n\nconst bytes = Math.floor(base64.length * 3 / 4);\nconst mb = +(bytes / 1024 / 1024).toFixed(2);\n\nreturn {\n  json: {\n    size_mb: mb,\n    caption: msg.content || \"\"\n  },\n  binary: {\n    photo: {\n      data: base64,\n      mimeType: mimeType,\n      fileName: \"img.png\"\n    }\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -368,
        3760
      ],
      "id": "0f62d0b3-d266-4c30-a089-a5ea52eb25bb",
      "name": "DataURL -> Binary"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "HTTP-Referer",
              "value": "https://n8n.io"
            },
            {
              "name": "X-Title",
              "value": "n8n-dev"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={ \"model\": \"google/gemini-2.5-flash-image\",\n  \"messages\": [{ \"role\": \"user\", \"content\": \"{{ $json.output }}\" }],\n  \"modalities\": [\"image\", \"text\"],\n  \"image_config\": {\n    \"aspect_ratio\": \"16:9\",\n    \"image_size\": \"1K\"\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -608,
        3760
      ],
      "id": "67f65865-f64a-48c8-aae9-4653689729b1",
      "name": "OpenRouter: Image1",
      "credentials": {
        "httpHeaderAuth": {
          "id": "Ujxf37NtSZLQ3mZC",
          "name": "Openrouter API"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.telegram.org/bot8509009391:AAGBWp-mq4OGs7WZJH0umlu8-0JORZc_H7A/editMessageMedia",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ ({\n  chat_id: $json.approve2_chat_id,\n  message_id: Number($json.approve2_photo_message_id),\n  media: JSON.stringify({\n    type: 'photo',\n    media: $('OpenAI: DALL-E 3').item.json.url,\n    caption: $json.title || '',\n    parse_mode: 'HTML'\n  })\n}) }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        624,
        3584
      ],
      "id": "f98284fc-7d8b-471e-914f-cea7187c0057",
      "name": "HTTP Request2",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        96,
        3760
      ],
      "id": "4ebd52a8-6761-4d4e-9542-a4cbdf1ef7f9",
      "name": "Merge2"
    },
    {
      "parameters": {
        "model": "openai/gpt-4o-audio-preview",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -1072,
        -528
      ],
      "id": "f9a399dd-1c7d-476c-a1d4-29e33eef7377",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "OPxPNafAYGtjuKlH",
          "name": "AI News"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendDocument",
        "chatId": "=392453315",
        "file": "BQACAgIAAxkBAAO1aXpjp7WteIFQCcHcgXcGOx9ZL2UAAqeZAAIfcdFLO_l-T5gSYlk4BA",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2656,
        -16
      ],
      "id": "9ad2058c-e4cb-49de-a3d7-0a28a5fdf85d",
      "name": "TG: –ê–ø—Ä—É–≤-2 (—Ñ–æ—Ç–æ)2",
      "webhookId": "0a567f92-1cda-4ab8-affd-8cf9ba927238",
      "retryOnFail": true,
      "credentials": {
        "telegramApi": {
          "id": "XWRfnd8MJgwnkvmg",
          "name": "KHC"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "rss?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ": {
      "main": [
        [
          {
            "node": "Answer Query a callback",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Answer Query a callback": {
      "main": [
        [
          {
            "node": "–ù—É–∂–Ω—ã–µ –∫–Ω–æ–ø–∫–∏?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ –≤ –ë–î": {
      "main": [
        [
          {
            "node": "–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°–∫–∞—á–∞—Ç—å HTML": {
      "main": [
        [
          {
            "node": "–ü–æ–ª—É—á–∏–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–≠–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä: –¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏": {
      "main": [
        [
          {
            "node": "–ü–æ–ª—É—á–∏–ª–æ—Å—å –ø—Ä–∏–≤–µ—Å—Ç–∏ –≤ –ø–æ—Ä—è–¥–æ–∫?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏": {
      "main": [
        [
          {
            "node": "–°–∫–∞—á–∞—Ç—å HTML",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –ß–∞—Ç—ã Telegram": {
      "main": [
        [
          {
            "node": "–ó–∞–ø–∏—Å–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ –≤ –ë–î",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ö–æ–¥: –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞": {
      "main": [
        [
          {
            "node": "–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–º—Ç—ã",
            "type": "main",
            "index": 0
          },
          {
            "node": "–°—Ç–∞—Ç—å—è+–ø—Ä–æ–º—Ç—ã",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "TG: –ê–ø—Ä—É–≤-2 (—Ñ–æ—Ç–æ)": {
      "main": [
        [
          {
            "node": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ID —Ñ–æ—Ç–æ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –ê–ø—Ä—É–≤-2 (–∞–Ω–æ–Ω—Å)": {
      "main": [
        [
          {
            "node": "–ö–æ–¥: –†–∞–∑–±–∏—Ç—å –ª–æ–Ω–≥—Ä–∏–¥ –¥–ª—è –¢–ì",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ID –∞–Ω–æ–Ω—Å–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏2": {
      "main": [
        [
          {
            "node": "–ï—Å–ª–∏: –ï—Å—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∞?2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å–ª–∏: –ï—Å—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∞?2": {
      "main": [
        [
          {
            "node": "TG: –ê–ø—Ä—É–≤-2 (–∞–Ω–æ–Ω—Å)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "TG: –ê–ø—Ä—É–≤-2 (–∞–Ω–æ–Ω—Å)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ò–ò: –õ–æ–Ω–≥—Ä–∏–¥": {
      "main": [
        [
          {
            "node": "–õ–æ–Ω–≥—Ä–∏–¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ò–ò: –ê–Ω–æ–Ω—Å": {
      "main": [
        [
          {
            "node": "–ê–Ω–æ–Ω—Å",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–º—Ç 3. –ò–ò: –ö–∞—Ä—Ç–∏–Ω–∫–∞": {
      "main": [
        [
          {
            "node": "OpenRouter: Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∞?": {
      "main": [
        [
          {
            "node": "–ü—Ä–æ–º—Ç 3. –ò–ò: –ö–∞—Ä—Ç–∏–Ω–∫–∞",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ü—Ä–æ–º—Ç 3. –ò–ò: –ö–∞—Ä—Ç–∏–Ω–∫–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–ª—É—á–∏–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É?": {
      "main": [
        [
          {
            "node": "–≠–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä: –¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–ª—É—á–∏–ª–æ—Å—å –ø—Ä–∏–≤–µ—Å—Ç–∏ –≤ –ø–æ—Ä—è–¥–æ–∫?": {
      "main": [
        [
          {
            "node": "–ö–æ–¥: –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ö–∞—Ä—Ç–∏–Ω–∫–∞": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "–õ–æ–Ω–≥—Ä–∏–¥": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "–ê–Ω–æ–Ω—Å": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å": {
      "main": [
        [
          {
            "node": "+title",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –ê–ø—Ä—É–≤-2 (–∫–Ω–æ–ø–∫–∏)1": {
      "main": [
        [
          {
            "node": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å id –∫–Ω–æ–ø–æ–∫",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ö–æ–¥: –†–∞–∑–±–∏—Ç—å –ª–æ–Ω–≥—Ä–∏–¥ –¥–ª—è –¢–ì": {
      "main": [
        [
          {
            "node": "–¶–∏–∫–ª: –ß–∞—Å—Ç–∏ –ª–æ–Ω–≥—Ä–∏–¥–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–¶–∏–∫–ª: –ß–∞—Å—Ç–∏ –ª–æ–Ω–≥—Ä–∏–¥–∞": {
      "main": [
        [
          {
            "node": "–ö–æ–¥: –°–æ–±—Ä–∞—Ç—å ID",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "TG: –ê–ø—Ä—É–≤-2 (–ª–æ–Ω–≥—Ä–∏–¥ —á–∞—Å—Ç—å)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –ê–ø—Ä—É–≤-2 (–ª–æ–Ω–≥—Ä–∏–¥ —á–∞—Å—Ç—å)": {
      "main": [
        [
          {
            "node": "–¶–∏–∫–ª: –ß–∞—Å—Ç–∏ –ª–æ–Ω–≥—Ä–∏–¥–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ê–ø–ø—Ä—É–≤–∏–º RSS?": {
      "main": [
        [
          {
            "node": "–ë–î: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–∏ RSS",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ë–î: –û—Ç–∫–ª–æ–Ω–∏—Ç—å (X1)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –û—Ç–∫–ª–æ–Ω–∏—Ç—å (X1)": {
      "main": [
        [
          {
            "node": "TG: –ù–æ–≤–æ—Å—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ù—É–∂–Ω—ã–µ –∫–Ω–æ–ø–∫–∏?": {
      "main": [
        [
          {
            "node": "–ê–ø–ø—Ä—É–≤–∏–º RSS?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏": {
      "main": [
        []
      ]
    },
    "image_url": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ID —Ñ–æ—Ç–æ": {
      "main": [
        []
      ]
    },
    "–ü–æ–ª—É—á–∏—Ç—å id": {
      "main": [
        [
          {
            "node": "–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É": {
      "main": [
        [
          {
            "node": "–ü–æ–ª—É—á–∏—Ç—å id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–º—Ç—ã": {
      "main": [
        [
          {
            "node": "–°—Ç–∞—Ç—å—è+–ø—Ä–æ–º—Ç—ã",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°—Ç–∞—Ç—å—è+–ø—Ä–æ–º—Ç—ã": {
      "main": [
        [
          {
            "node": "–ò–ò: –ê–Ω–æ–Ω—Å",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ò–ò: –õ–æ–Ω–≥—Ä–∏–¥",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ï—Å—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∞?",
            "type": "main",
            "index": 0
          },
          {
            "node": "–î—Ä–∞—Ñ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤": {
      "main": [
        [
          {
            "node": "–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ö–æ–¥: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è": {
      "main": [
        [
          {
            "node": "–ï—Å–ª–∏: –≠—Ç–æ –∫–Ω–æ–ø–∫–∞?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å–ª–∏: –≠—Ç–æ –∫–Ω–æ–ø–∫–∞?": {
      "main": [
        [
          {
            "node": "TG: Answer Callback",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ï—Å–ª–∏: –≠—Ç–æ –≥–æ–ª–æ—Å?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: Answer Callback": {
      "main": [
        [
          {
            "node": "Switch: –î–µ–π—Å—Ç–≤–∏–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch: –î–µ–π—Å—Ç–≤–∏–µ": {
      "main": [
        [
          {
            "node": "TG: –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ë–î: –°—Ç–∞—Ä—Ç –ø—Ä–∞–≤–∫–∏ (R2)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "TG: –£–¥–∞–ª–∏—Ç—å –∫–Ω–æ–ø–∫–∏ (X2)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "TG: –ó–∞–ø—Ä–æ—Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ë–î: –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ë–î: –ü–æ–ª—É—á–∏—Ç—å –†–µ—Ü–µ–ø—Ç—ã",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "TG: –°–ø—Ä–æ—Å–∏—Ç—å –¥–∞—Ç—É",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –£–¥–∞–ª–∏—Ç—å –∫–Ω–æ–ø–∫–∏ (X2)": {
      "main": [
        [
          {
            "node": "–ë–î: –°–∫–∏–ø (X2)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –ó–∞–ø—Ä–æ—Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏": {
      "main": [
        [
          {
            "node": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–ª—å –ø—Ä–∞–≤–∫–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –°–ø—Ä–æ—Å–∏—Ç—å –¥–∞—Ç—É": {
      "main": [
        [
          {
            "node": "–ë–î: –ñ–¥–µ–º –¥–∞—Ç—É",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å–ª–∏: –≠—Ç–æ –≥–æ–ª–æ—Å?": {
      "main": [
        [
          {
            "node": "TG: –°–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –°–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ": {
      "main": [
        [
          {
            "node": "OpenAI: –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI: –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è": {
      "main": [
        [
          {
            "node": "–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß—Ç–æ –ø—Ä–∞–≤–∏–º?": {
      "main": [
        [
          {
            "node": "AI: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∞–Ω–æ–Ω—Å",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ª–æ–Ω–≥—Ä–∏–¥",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI: –ü—Ä–æ–º—Ç –¥–ª—è DALL-E",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI: –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI: DALL-E 3": {
      "main": [
        []
      ]
    },
    "TG: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (–ü–ª–∞–Ω)": {
      "main": [
        [
          {
            "node": "–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è": {
      "main": [
        [
          {
            "node": "TG: –í–µ—Ä–Ω—É—Ç—å –º–µ–Ω—é",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é –ø—Ä–∞–≤–∫—É": {
      "main": [
        [
          {
            "node": "–ß—Ç–æ –ø—Ä–∞–≤–∏–º?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –°—Ç–∞—Ä—Ç –ø—Ä–∞–≤–∫–∏ (R2)": {
      "main": [
        [
          {
            "node": "TG: –ú–µ–Ω—é –ø—Ä–∞–≤–æ–∫",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–Ω–≥—Ä–∏–¥": {
      "main": [
        [
          {
            "node": "–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É": {
      "main": [
        [
          {
            "node": "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ + –∫–Ω–æ–ø–∫–∏1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –£–¥–∞–ª–∏—Ç—å –º–µ–Ω—é –≤—Ä–µ–º–µ–Ω–∏": {
      "main": [
        [
          {
            "node": "TG: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (Now)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–æ–Ω—Å": {
      "main": [
        [
          {
            "node": "–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç": {
      "main": [
        [
          {
            "node": "–ë–î: –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é –ø—Ä–∞–≤–∫—É",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ": {
      "main": [
        [
          {
            "node": "TG: –£–¥–∞–ª–∏—Ç—å –æ—Ç–≤–µ—Ç —é–∑–µ—Ä–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –£–¥–∞–ª–∏—Ç—å –æ—Ç–≤–µ—Ç —é–∑–µ—Ä–∞": {
      "main": [
        [
          {
            "node": "TG: –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å –±–æ—Ç–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å –±–æ—Ç–∞": {
      "main": [
        [
          {
            "node": "–û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–æ–Ω—Å",
            "type": "main",
            "index": 0
          },
          {
            "node": "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ + –∫–Ω–æ–ø–∫–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ1": {
      "main": [
        [
          {
            "node": "TG: –£–¥–∞–ª–∏—Ç—å –æ—Ç–≤–µ—Ç —é–∑–µ—Ä–∞1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –£–¥–∞–ª–∏—Ç—å –æ—Ç–≤–µ—Ç —é–∑–µ—Ä–∞1": {
      "main": [
        [
          {
            "node": "TG: –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å –±–æ—Ç–∞1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å –±–æ—Ç–∞1": {
      "main": [
        [
          {
            "node": "–ö–æ–¥: –ê–Ω–∞–ª–∏–∑ (Edit –∏–ª–∏ Rebuild?)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ö–æ–¥: –ê–Ω–∞–ª–∏–∑ (Edit –∏–ª–∏ Rebuild?)": {
      "main": [
        [
          {
            "node": "IF: –ú–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç—å?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ2": {
      "main": [
        [
          {
            "node": "TG: –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å –±–æ—Ç–∞2",
            "type": "main",
            "index": 0
          },
          {
            "node": "TG: –£–¥–∞–ª–∏—Ç—å –æ—Ç–≤–µ—Ç —é–∑–µ—Ä–∞2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ3": {
      "main": [
        [
          {
            "node": "TG: –£–¥–∞–ª–∏—Ç—å –æ—Ç–≤–µ—Ç —é–∑–µ—Ä–∞3",
            "type": "main",
            "index": 0
          },
          {
            "node": "TG: –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å –±–æ—Ç–∞3",
            "type": "main",
            "index": 0
          },
          {
            "node": "TG: –£–¥–∞–ª–∏—Ç—å –º–µ–Ω—é –≤—Ä–µ–º–µ–Ω–∏1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –ü–æ–ª—É—á–∏—Ç—å –†–µ—Ü–µ–ø—Ç—ã": {
      "main": [
        [
          {
            "node": "–ö–æ–¥: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Jobs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ö–æ–¥: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Jobs": {
      "main": [
        [
          {
            "node": "Create a row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a row": {
      "main": [
        [
          {
            "node": "–ë–î: –°—Ç–∞—Ç—É—Å Approved",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –ü–æ–ª—É—á–∏—Ç—å –†–µ—Ü–µ–ø—Ç—ã1": {
      "main": [
        [
          {
            "node": "–ö–æ–¥: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Jobs1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ö–æ–¥: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Jobs1": {
      "main": [
        [
          {
            "node": "–°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –°—Ç–∞—Ç—É—Å Approved1": {
      "main": [
        [
          {
            "node": "TG: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (–ü–ª–∞–Ω)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI: –ü—Ä–æ–º—Ç –¥–ª—è DALL-E": {
      "main": [
        [
          {
            "node": "OpenRouter: Image1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∞–Ω–æ–Ω—Å": {
      "main": [
        [
          {
            "node": "–ë–î: –û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–æ–Ω—Å",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI: –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã": {
      "main": [
        [
          {
            "node": "–ë–î: –ü–æ–ª—É—á–∏—Ç—å –†–µ—Ü–µ–ø—Ç—ã1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ª–æ–Ω–≥—Ä–∏–¥": {
      "main": [
        [
          {
            "node": "–ë–î: –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–Ω–≥—Ä–∏–¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "rss?": {
      "main": [
        [
          {
            "node": "–†–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∞–∂–∞—Ç–∏–µ",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ë–î: –ü–æ–ª—É—á–∏—Ç—å ID —á–∞—Ç–æ–≤",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF: –ú–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç—å?": {
      "main": [
        [
          {
            "node": "TG: –ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç—å (Edit)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ö–æ–¥: ID –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç—å (Edit)": {
      "main": [
        [
          {
            "node": "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ + –∫–Ω–æ–ø–∫–∏2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ö–æ–¥: ID –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è": {
      "main": [
        [
          {
            "node": "–¶–∏–∫–ª: –£–¥–∞–ª–µ–Ω–∏–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–¶–∏–∫–ª: –£–¥–∞–ª–µ–Ω–∏–µ": {
      "main": [
        [
          {
            "node": "–ö–æ–¥: –ß–∞–Ω–∫–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "TG: –£–¥–∞–ª–∏—Ç—å (Loop)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –£–¥–∞–ª–∏—Ç—å (Loop)": {
      "main": [
        [
          {
            "node": "–¶–∏–∫–ª: –£–¥–∞–ª–µ–Ω–∏–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ö–æ–¥: –ß–∞–Ω–∫–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏": {
      "main": [
        [
          {
            "node": "–¶–∏–∫–ª: –û—Ç–ø—Ä–∞–≤–∫–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–¶–∏–∫–ª: –û—Ç–ø—Ä–∞–≤–∫–∞": {
      "main": [
        [
          {
            "node": "–ö–æ–¥: –°–æ–±—Ä–∞—Ç—å ID (Rebuild)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "TG: –û—Ç–ø—Ä–∞–≤–∏—Ç—å (Loop)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –û—Ç–ø—Ä–∞–≤–∏—Ç—å (Loop)": {
      "main": [
        [
          {
            "node": "–¶–∏–∫–ª: –û—Ç–ø—Ä–∞–≤–∫–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–Ω–≥—Ä–∏–¥ approve2_longread_msg_ids": {
      "main": [
        [
          {
            "node": "TG: –ê–ø—Ä—É–≤-2 (–∫–Ω–æ–ø–∫–∏)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ö–æ–¥: –°–æ–±—Ä–∞—Ç—å ID": {
      "main": [
        [
          {
            "node": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–Ω–≥—Ä–∏–¥ approve2_longread_msg_ids",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ö–æ–¥: –°–æ–±—Ä–∞—Ç—å ID (Rebuild)": {
      "main": [
        [
          {
            "node": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–Ω–≥—Ä–∏–¥ (Rebuild)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–Ω–≥—Ä–∏–¥ (Rebuild)": {
      "main": [
        [
          {
            "node": "TG: –ê–ø—Ä—É–≤-2 (–ù–û–í–´–ï –∫–Ω–æ–ø–∫–∏)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –ê–ø—Ä—É–≤-2 (–ù–û–í–´–ï –∫–Ω–æ–ø–∫–∏)1": {
      "main": [
        [
          {
            "node": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–Ω–æ–ø–∫—É (Rebuild)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–Ω–æ–ø–∫—É (Rebuild)": {
      "main": [
        [
          {
            "node": "TG: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–Ω–æ–ø–∫–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å–ª–∏: –£–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–∞–≤–∫–∞?": {
      "main": [
        [
          {
            "node": "TG: –û—à–∏–±–∫–∞ (–ó–∞–Ω—è—Ç–æ)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏": {
      "main": [
        [
          {
            "node": "–ï—Å–ª–∏: –£–∂–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–∞–≤–∫–∞?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–∏ RSS": {
      "main": [
        [
          {
            "node": "–ï—Å–ª–∏: –û—á–µ—Ä–µ–¥—å –∑–∞–Ω—è—Ç–∞?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å–ª–∏: –û—á–µ—Ä–µ–¥—å –∑–∞–Ω—è—Ç–∞?": {
      "main": [
        [
          {
            "node": "TG: –û—à–∏–±–∫–∞ –æ—á–µ—Ä–µ–¥–∏",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ë–î: –ß–∞—Ç—ã Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "–ë–î: –û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –°—Ç–∞—Ç—É—Å Approved": {
      "main": [
        [
          {
            "node": "TG: –£–¥–∞–ª–∏—Ç—å –º–µ–Ω—é –≤—Ä–µ–º–µ–Ω–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏": {
      "main": [
        [
          {
            "node": "–ë–î: –°—Ç–∞—Ç—É—Å Approved1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–î—Ä–∞—Ñ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞": {
      "main": [
        [
          {
            "node": "–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è draft title",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è draft title": {
      "main": [
        [
          {
            "node": "update –¥—Ä–∞—Ñ—Ç",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "update –¥—Ä–∞—Ñ—Ç": {
      "main": [
        [
          {
            "node": "–ó–∞–≥–æ–ª–æ–≤–æ–∫",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "+title": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "–ó–∞–≥–æ–ª–æ–≤–æ–∫": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "TG: –ê–ø—Ä—É–≤-2 (—Ñ–æ—Ç–æ)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "r. draft title": {
      "ai_languageModel": [
        [
          {
            "node": "–î—Ä–∞—Ñ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "r. draft anounce": {
      "ai_languageModel": [
        [
          {
            "node": "–ò–ò: –ê–Ω–æ–Ω—Å",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "r. draft longrid": {
      "ai_languageModel": [
        [
          {
            "node": "–ò–ò: –õ–æ–Ω–≥—Ä–∏–¥",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "r. draft pic": {
      "ai_languageModel": [
        [
          {
            "node": "–ü—Ä–æ–º—Ç 3. –ò–ò: –ö–∞—Ä—Ç–∏–Ω–∫–∞",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter: Image": {
      "main": [
        [
          {
            "node": "DataURL -> Binary1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DataURL -> Binary1": {
      "main": [
        [
          {
            "node": "TG: –ê–ø—Ä—É–≤-2 (—Ñ–æ—Ç–æ)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TG: –ê–ø—Ä—É–≤-2 (—Ñ–æ—Ç–æ)1": {
      "main": [
        [
          {
            "node": "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ID —Ñ–æ—Ç–æ1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–î: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ID —Ñ–æ—Ç–æ1": {
      "main": [
        [
          {
            "node": "image_url",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "r. gpt 5.2 (2)": {
      "ai_languageModel": [
        [
          {
            "node": "AI: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∞–Ω–æ–Ω—Å",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "r. gpt 5.2": {
      "ai_languageModel": [
        [
          {
            "node": "AI: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ª–æ–Ω–≥—Ä–∏–¥",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "r. gpt 5.2 (1)": {
      "ai_languageModel": [
        [
          {
            "node": "AI: –ü—Ä–æ–º—Ç –¥–ª—è DALL-E",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "r. gpt 5  nano": {
      "ai_languageModel": [
        [
          {
            "node": "AI: –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter: Image1": {
      "main": [
        [
          {
            "node": "DataURL -> Binary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DataURL -> Binary": {
      "main": [
        [
          {
            "node": "–ë–î: –ü–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false,
    "timeSavedMode": "fixed",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "111tTOvNeCW5G0rn"
  },
  "versionId": "58e09374-49ec-41e5-a10d-3beaea249449",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "a3be3517ac16055c74c794d80ee41ecf8379a31765686f5b788ba2bac8e2a816"
  },
  "id": "ypKOoa6LyuJsTObU",
  "tags": []
}